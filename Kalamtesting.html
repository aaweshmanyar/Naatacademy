<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">

    <!-- SEO: Primary Meta Tags -->
    <title>Naat Lyrics, Islamic Lyrics - A-Z Kalam, Hamd, Naat, Manqabat, Salam, Tazmeen Collection by Naat Academy
    </title>
    <meta name="description"
        content="Naat Academy has collected all lyrics so that every Islamic kalam is easily and correctly available to you. The largest collection for Naat Lyrics.">
    <meta name="keywords"
        content="Naat Lyrics, Hamd, Manqabat, Kalam, Roman Urdu, Naat Sharif, Allama Iqbal, Ahmed Raza Khan, Hadaiq-e-Bakhshish, Jashn e Milad, Shane Mustafa, kalam e Aalahazrat, Naghmat e Akhtar, Allama Hasan Raza, Qasida, Durood o Naat, Yaad e Madinah, Hazri Darbar e Rislat, Manqabat e Siddiq e Akbar, Manqab e Maula Ali">
    <link rel="canonical" href="https://naatacademy.com/naatlyrics.html">

    <!-- Favicon -->
    <link rel="icon"
        href="https://res.cloudinary.com/awescreative/image/upload/v1749154768/Awes/new_logo_naat_academy_image.png"
        type="image/png">
    <link rel="apple-touch-icon"
        href="https://res.cloudinary.com/awescreative/image/upload/v1749154768/Awes/new_logo_naat_academy_image.png">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://naatacademy.com/naatlyrics.html">
    <meta property="og:title" content="Naat Academy - The Ultimate Collection of Naat Lyrics">
    <meta property="og:description"
        content="Find lyrics for any Naat, Hamd, Manqabat, and Kalam. The most comprehensive and accurate collection of Islamic poetry online.">
    <meta property="og:image"
        content="https://res.cloudinary.com/awescreative/image/upload/v1749154768/Awes/new_logo_naat_academy_image.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://naatacademy.com/naatlyrics.html">
    <meta property="twitter:title" content="Naat Academy - The Ultimate Collection of Naat Lyrics">
    <meta property="twitter:description"
        content="Find lyrics for any Naat, Hamd, Manqabat, and Kalam. The most comprehensive and accurate collection of Islamic poetry online.">
    <meta property="twitter:image"
        content="https://res.cloudinary.com/awescreative/image/upload/v1749154768/Awes/new_logo_naat_academy_image.png">

    <!-- Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Sofia+Sans:wght@400;600;700;800&family=Noto+Nastaliq+Urdu:wght@400;700&display=swap"
        rel="stylesheet">

    <style>
        :root {
            --bg-start-rgb: 243, 244, 246;
            --bg-end-rgb: 224, 231, 255;
            --primary-color: #065f46;
            --text-primary: #111827;
            --text-secondary: #4B5563;
        }

        html {
            -webkit-tap-highlight-color: transparent;
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Sofia Sans', sans-serif;
            color: var(--text-primary);
            background-image: linear-gradient(to bottom, rgb(var(--bg-start-rgb)), rgb(var(--bg-end-rgb)));
        }

        .font-urdu {
            font-family: 'Noto Nastaliq Urdu', serif;
        }

        #app-wrapper {
            padding-top: 70px;
            padding-bottom: 100px;
            min-height: 100vh;
        }

        .NaatLyrics-top-bar,
        .NaatLyrics-bottom-nav {
            background: rgba(255, 255, 255, 0.7);
            -webkit-backdrop-filter: blur(12px);
            backdrop-filter: blur(12px);
        }

        .NaatLyrics-top-bar {
            position: fixed;
            height: 70px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1rem;
            top: 0;
            left: 0;
            right: 0;
            z-index: 50;
        }

        .NaatLyrics-top-bar-left {
            display: flex;
            align-items: center;
        }

        .NaatLyrics-top-bar-right {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            justify-content: flex-end;
        }

        #NaatLyrics-brand.hidden {
            display: none;
        }

        .NaatLyrics-top-bar-button {
            height: 44px;
            width: 44px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .NaatLyrics-top-bar-button:active {
            background-color: rgba(0, 0, 0, 0.05);
        }

        #NaatLyrics-back-button.hidden {
            transform: translateX(-20px);
            opacity: 0;
            pointer-events: none;
        }

        #NaatLyrics-back-button:not(.hidden) {
            transform: translateX(0);
            opacity: 1;
        }


        .NaatLyrics-bottom-nav-container {
            position: fixed;
            bottom: 20px;
            left: 0;
            right: 0;
            z-index: 100;
            padding: 0 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        .NaatLyrics-bottom-nav {
            height: 70px;
            border-radius: 1.5rem;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 0 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        .NaatLyrics-bottom-nav-item {
            color: var(--text-secondary);
            transition: color 0.3s ease;
            flex: 1;
            cursor: pointer;
            font-weight: 600;
        }

        .NaatLyrics-bottom-nav-item.active {
            color: var(--primary-color);
        }

        .NaatLyrics-nav-text {
            font-size: 0.75rem;
            line-height: 1.1;
        }

        .NaatLyrics-nav-icon {
            font-size: 1.5rem;
            margin-bottom: 2px;
        }

        .NaatLyrics-page {
            display: none;
            animation: fadeIn 0.3s ease-out;
        }

        .NaatLyrics-page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes scroll {
            0% {
                transform: translateX(0);
            }

            100% {
                transform: translateX(calc(-250px * 6));
            }
        }

        .NaatLyrics-slider-container {
            padding: 1.25rem 0;
            overflow: hidden;
            position: relative;
        }

        .NaatLyrics-slider-container::before,
        .NaatLyrics-slider-container::after {
            content: '';
            position: absolute;
            top: 0;
            bottom: 0;
            width: 50px;
            z-index: 2;
        }

        .NaatLyrics-slider-container::before {
            left: 0;
            background: linear-gradient(to right, rgb(var(--bg-start-rgb)), transparent);
        }

        .NaatLyrics-slider-container::after {
            right: 0;
            background: linear-gradient(to left, rgb(var(--bg-start-rgb)), transparent);
        }

        .NaatLyrics-slider-track {
            display: flex;
            width: calc(250px * 12);
            animation: scroll 30s linear infinite;
        }

        .NaatLyrics-slider-track:hover {
            animation-play-state: paused;
        }

        .NaatLyrics-slider-card {
            width: 250px;
            flex-shrink: 0;
            padding: 0 10px;
            cursor: pointer;
        }

        .NaatLyrics-slider-card-inner {
            border-radius: 1rem;
            padding: 1rem;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            height: 120px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .NaatLyrics-slider-card-inner:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .NaatLyrics-slider-card-inner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent 70%);
        }

        .NaatLyrics-slider-card-title {
            position: relative;
            font-weight: 700;
            font-size: 1rem;
            line-height: 1.3;
            margin-top: auto;
            /* Clamp title to 2 lines */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            height: 2.6em;
            /* 2 * line-height */
        }

        .NaatLyrics-slider-card-shayar {
            position: relative;
            font-weight: 600;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .NaatLyrics-slider-card-labels {
            position: relative;
            display: flex;
            gap: 4px;
            font-size: 0.6rem;
            font-weight: 800;
            text-transform: uppercase;
        }

        .NaatLyrics-sorter-section {
            background-image: linear-gradient(135deg, #ffffff 0%, #f7f9fc 100%);
            border-radius: 1.25rem;
            margin: 0 1rem;
            padding: 0.75rem;
            box-shadow: 0 8px 30px -10px rgba(0, 0, 0, 0.08);
            border: 1px solid #fff;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        .NaatLyrics-sorter-tabs {
            display: flex;
            background-color: rgb(var(--bg-start-rgb));
            border-radius: 999px;
            padding: 4px;
        }

        .NaatLyrics-tab-button {
            flex: 1;
            padding: 0.5rem;
            border-radius: 999px;
            font-weight: 700;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }

        .NaatLyrics-tab-button.active {
            background-image: linear-gradient(45deg, #015519, #23a609);
            color: white;
            box-shadow: 0 4px 10px -2px rgba(1, 85, 25, 0.4);
        }

        .NaatLyrics-tab-pane {
            display: none;
        }

        .NaatLyrics-tab-pane.active {
            display: block;
            animation: fadeIn 0.4s;
        }

        .NaatLyrics-alphabet-sorter,
        .NaatLyrics-trending-topics {
            display: flex;
            overflow-x: auto;
            padding: 0.75rem 0.25rem;
            gap: 0.5rem;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .NaatLyrics-alphabet-sorter::-webkit-scrollbar,
        .NaatLyrics-trending-topics::-webkit-scrollbar {
            display: none;
        }

        .NaatLyrics-alpha-button {
            flex-shrink: 0;
            padding: 0.5rem 0.75rem;
            border-radius: 0.75rem;
            background-color: transparent;
            color: var(--text-secondary);
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .NaatLyrics-alpha-button.active {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-2px);
        }

        .NaatLyrics-trending-topic {
            flex-shrink: 0;
            padding: 4px 12px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            color: white;
            border: 1px solid transparent;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .NaatLyrics-trending-topic.active {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px -2px rgba(0, 0, 0, 0.2);
        }

        .NaatLyrics-trending-topic .count {
            font-size: 0.7rem;
            font-weight: 700;
            transition: color 0.2s ease;
            opacity: 0.8;
        }

        /* Kalam List Item */
        .NaatLyrics-qalam-item {
            background-color: #fff;
            border-radius: 1.25rem;
            padding: 0.4rem 1rem;
            /* Reduced vertical padding */
            box-shadow: 0 4px 15px -5px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        .NaatLyrics-qalam-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -10px rgba(0, 0, 0, 0.1);
        }

        .NaatLyrics-qalam-title {
            font-weight: 800;
            color: #111827;
            font-size: 1.2rem;
            /* Increased font size */
            line-height: 1.3;
        }

        .NaatLyrics-qalam-emoji {
            flex-shrink: 0;
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            margin-right: 1rem;
            background-image: linear-gradient(to top, #f3e7e9 0%, #e3eeff 99%, #e3eeff 100%);
        }

        .NaatLyrics-labels-container {
            display: flex;
            flex-wrap: wrap;
            gap: 0.25rem;
            align-items: center;
            margin-bottom: 0.25rem;
        }

        .NaatLyrics-category-label,
        .NaatLyrics-topic-label {
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            background-clip: text;
            -webkit-background-clip: text;
            color: transparent;
        }

        .qalam-cat-naat {
            background-image: linear-gradient(45deg, #047857, #10b981);
        }

        .qalam-cat-hamd {
            background-image: linear-gradient(45deg, #065f46, #10b981);
        }

        .qalam-cat-manqabat {
            background-image: linear-gradient(45deg, #92400e, #f59e0b);
        }

        .qalam-cat-salam {
            background-image: linear-gradient(45deg, #4c1d95, #8b5cf6);
        }

        .qalam-cat-kalam {
            background-image: linear-gradient(45deg, #9f1239, #ec4899);
        }

        .qalam-cat-munajat {
            background-image: linear-gradient(45deg, #991b1b, #ef4444);
        }

        .qalam-cat-tazmeen {
            background-image: linear-gradient(45deg, #854d0e, #ca8a04);
        }

        .qalam-cat-default {
            background-image: linear-gradient(45deg, #374151, #6b7280);
        }

        .NaatLyrics-qalam-view-count {
            font-size: 0.65rem;
            color: var(--text-secondary);
            font-weight: 600;
            margin-left: auto;
        }

        /* Generic List Item for Category, Topic, Writer pages */
        .NaatLyrics-list-item {
            background-color: #fff;
            border-radius: 1.25rem;
            padding: 1rem 1.5rem;
            box-shadow: 0 4px 15px -5px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .NaatLyrics-list-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px -10px rgba(0, 0, 0, 0.1);
        }

        /* Kalam Detail Page */
        .NaatLyrics-detail-title {
            font-weight: 800;
        }

        #NaatLyrics-page-qalam-detail .NaatLyrics-qalam-pane {
            background-color: #fff;
            padding: 1.5rem;
            border-radius: 1.25rem;
            line-height: 1.5;
            /* Reduced by 40% from 2.5 */
            font-size: 1.5rem;
            /* Increased by 25% from 1.2rem */
            text-align: center;
            font-weight: 400;
        }

        .NaatLyrics-detail-actions {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
        }

        .NaatLyrics-action-btn,
        #NaatLyrics-save-kalam-btn,
        #NaatLyrics-share-kalam-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 999px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 10px -2px rgba(6, 95, 70, 0.4);
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
        }

        #NaatLyrics-save-kalam-btn,
        #NaatLyrics-share-kalam-btn {
            padding: 0.3rem 0.8rem;
            font-size: 0.8rem;
        }

        .NaatLyrics-action-btn {
            background-color: #6b7280;
        }

        #NaatLyrics-save-kalam-btn.saved {
            background: #10b981;
        }

        #NaatLyrics-share-kalam-btn {
            background-image: linear-gradient(45deg, #2563eb, #60a5fa);
            box-shadow: 0 4px 10px -2px rgba(37, 99, 235, 0.4);
        }

        /* Story Viewer */
        #NaatLyrics-story-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 200;
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: white;
            /* Ensures all text inside is white */
        }

        #NaatLyrics-story-viewer.active {
            display: flex;
            opacity: 1;
        }

        .NaatLyrics-story-container {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .NaatLyrics-story-content {
            background-image: linear-gradient(45deg, #065f46, #10b981);
            width: 90%;
            max-width: 400px;
            height: 85vh;
            max-height: 700px;
            border-radius: 1.25rem;
            color: white;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            /* Animation: Initial state */
            transform: translateY(40px) scale(0.95);
            opacity: 0;
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.3s ease-out;
        }

        #NaatLyrics-story-viewer.active .NaatLyrics-story-content {
            /* Animation: Active state */
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        .NaatLyrics-story-progress-container {
            position: absolute;
            top: 1rem;
            left: 1rem;
            right: 1rem;
            display: flex;
            gap: 4px;
            z-index: 10;
        }

        .NaatLyrics-story-progress-bar {
            flex: 1;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
        }

        .NaatLyrics-story-progress-bar-inner {
            height: 100%;
            background-color: white;
            width: 0%;
        }

        .NaatLyrics-story-progress-bar.active .NaatLyrics-story-progress-bar-inner {
            width: 100%;
            transition: width 5s linear;
        }

        .NaatLyrics-story-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 2rem;
            color: white;
            cursor: pointer;
            z-index: 10;
        }

        .NaatLyrics-story-topic-chip {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 999px;
            font-weight: 700;
            font-size: 0.9rem;
            margin-bottom: 1.5rem;
        }

        .NaatLyrics-story-lyrics {
            font-size: 1.8rem;
            line-height: 1.5;
            font-weight: 800;
            margin-bottom: 1.5rem;
        }

        .NaatLyrics-story-meta {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 1.5rem;
            font-weight: 600;
        }

        .NaatLyrics-story-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        #NaatLyrics-story-like-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .NaatLyrics-story-bottom-bar {
            position: absolute;
            bottom: 1.5rem;
            left: 1.5rem;
            right: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }

        .NaatLyrics-story-share-btn {
            background-color: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
        }

        /* Enhanced Search Popup */
        #NaatLyrics-search-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgb(var(--bg-start-rgb)), rgb(var(--bg-end-rgb)));
            z-index: 150;
            transform: translateY(-100%);
            transition: transform 0.4s ease-in-out;
            display: flex;
            flex-direction: column;
            padding: 1rem;
            padding-top: 5vh;
        }

        #NaatLyrics-search-popup.active {
            transform: translateY(0);
        }

        .NaatLyrics-search-popup-header {
            display: flex;
            align-items: center;
            flex-shrink: 0;
        }

        .NaatLyrics-search-popup-content {
            flex: 1;
            overflow-y: auto;
            margin-top: 1rem;
        }

        #NaatLyrics-search-popup-title {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-primary);
            text-align: center;
            margin-bottom: 1rem;
        }

        .NaatLyrics-search-input-container {
            position: relative;
        }

        .NaatLyrics-search-input {
            width: 100%;
            padding: 1rem 1.5rem;
            font-size: 1.1rem;
            border: 2px solid #e5e7eb;
            border-radius: 999px;
            transition: border-color 0.2s, box-shadow 0.2s;
            font-weight: 600;
        }

        .NaatLyrics-search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(6, 95, 70, 0.2);
        }

        #NaatLyrics-search-close-btn {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 60px;
            font-size: 1.5rem;
            color: var(--text-secondary);
        }

        .NaatLyrics-search-chip {
            background-color: rgba(0, 0, 0, 0.05);
            color: var(--text-secondary);
            padding: 0.4rem 0.9rem;
            border-radius: 999px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
            border: none;
        }

        .NaatLyrics-search-chip:hover {
            background-color: var(--primary-color);
            color: white;
        }
    </style>
    <!-- Structured Data -->
    <script type="application/ld+json" id="NaatLyrics-structured-data">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Naat Academy",
      "url": "https://naatacademy.com/naatlyrics.html",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://naatacademy.com/naatlyrics.html#search={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
</head>

<body>

    <div id="app-wrapper">
        <header class="NaatLyrics-top-bar">
            <div class="NaatLyrics-top-bar-left">
                <button id="NaatLyrics-back-button" class="NaatLyrics-top-bar-button hidden"><i
                        class="bi bi-arrow-left text-2xl"></i></button>
                <div id="NaatLyrics-brand" class="flex items-center gap-2">
                    <img src="https://res.cloudinary.com/awescreative/image/upload/v1749154768/Awes/new_logo_naat_academy_image.png"
                        alt="Naat Academy Logo" class="h-10">
                    <span class="font-bold text-lg text-gray-800">Naat Academy</span>
                </div>
            </div>
            <div class="NaatLyrics-top-bar-right">
                <a href="https://whatsapp.com/channel/0029Va98TkcKrWQpctdEpu0f" target="_blank"
                    class="NaatLyrics-top-bar-button text-green-500"><i class="bi bi-whatsapp text-2xl"></i></a>
                <button id="NaatLyrics-search-icon-btn" class="NaatLyrics-top-bar-button"><i
                        class="bi bi-search text-xl"></i></button>
            </div>
        </header>

        <main>
            <!-- Main Content Pages -->
            <div id="NaatLyrics-page-majmua" class="NaatLyrics-page active">
                <section class="NaatLyrics-slider-container">
                    <div id="NaatLyrics-slider-track" class="NaatLyrics-slider-track"></div>
                </section>
                <div class="NaatLyrics-sorter-section">
                    <div class="NaatLyrics-sorter-tabs">
                        <button class="NaatLyrics-tab-button active" data-tab="trending">Trending</button>
                        <button class="NaatLyrics-tab-button" data-tab="alphabet">Browse A-Z</button>
                    </div>
                    <div class="sorter-content mt-2">
                        <div id="NaatLyrics-alphabet-pane" class="NaatLyrics-tab-pane">
                            <div id="NaatLyrics-alphabet-sorter" class="NaatLyrics-alphabet-sorter"></div>
                        </div>
                        <div id="NaatLyrics-trending-pane" class="NaatLyrics-tab-pane active">
                            <div id="NaatLyrics-trending-topics" class="NaatLyrics-trending-topics"></div>
                        </div>
                    </div>
                </div>
                <div class="container mx-auto px-4 py-4">
                    <div id="NaatLyrics-qalam-list" class="space-y-3"></div>
                </div>
            </div>
            <!-- Category, Topic, and Writer pages now use list view -->
            <div id="NaatLyrics-page-category" class="NaatLyrics-page container mx-auto px-4 py-8">
                <h2 class="text-2xl font-bold mb-4">Categories</h2>
                <div id="NaatLyrics-category-list" class="space-y-3"></div>
            </div>
            <div id="NaatLyrics-page-topics" class="NaatLyrics-page container mx-auto px-4 py-8">
                <h2 class="text-2xl font-bold mb-4">Topics</h2>
                <div id="NaatLyrics-topic-list" class="space-y-3"></div>
            </div>
            <div id="NaatLyrics-page-writers" class="NaatLyrics-page container mx-auto px-4 py-8">
                <h2 class="text-2xl font-bold mb-4">Writers & Books</h2>
                <div id="NaatLyrics-writer-list" class="space-y-3"></div>
            </div>
            <div id="NaatLyrics-page-saved" class="NaatLyrics-page container mx-auto px-4 py-8">
                <h2 class="text-2xl font-bold mb-4">Saved Kalams</h2>
                <div id="NaatLyrics-saved-list" class="space-y-3 mt-6"></div>
            </div>
            <div id="NaatLyrics-page-qalam-detail" class="NaatLyrics-page container mx-auto px-4 py-8">
                <div id="NaatLyrics-qalam-detail-content"></div>
            </div>
        </main>

        <div class="NaatLyrics-bottom-nav-container">
            <nav class="NaatLyrics-bottom-nav">
                <a data-page="majmua"
                    class="NaatLyrics-bottom-nav-item active flex flex-col items-center justify-center text-center p-2"><span
                        class="NaatLyrics-nav-icon">📚</span><span class="NaatLyrics-nav-text">Majmua</span></a>
                <a data-page="category"
                    class="NaatLyrics-bottom-nav-item flex flex-col items-center justify-center text-center p-2"><span
                        class="NaatLyrics-nav-icon">🏷️</span><span class="NaatLyrics-nav-text">Category</span></a>
                <a data-page="topics"
                    class="NaatLyrics-bottom-nav-item flex flex-col items-center justify-center text-center p-2"><span
                        class="NaatLyrics-nav-icon">💡</span><span class="NaatLyrics-nav-text">Topics</span></a>
                <a data-page="writers"
                    class="NaatLyrics-bottom-nav-item flex flex-col items-center justify-center text-center p-2"><span
                        class="NaatLyrics-nav-icon">✍️</span><span class="NaatLyrics-nav-text">Writers</span></a>
                <a data-page="saved"
                    class="NaatLyrics-bottom-nav-item flex flex-col items-center justify-center text-center p-2"><span
                        class="NaatLyrics-nav-icon">❤️</span><span class="NaatLyrics-nav-text">Saved</span></a>
            </nav>
        </div>
    </div>

    <!-- Story Viewer -->
    <div id="NaatLyrics-story-viewer">
        <div class="NaatLyrics-story-container">
            <div id="NaatLyrics-story-content"></div>
        </div>
    </div>

    <!-- Search Popup -->
    <div id="NaatLyrics-search-popup">
        <div class="NaatLyrics-search-popup-header">
            <h2 id="NaatLyrics-search-popup-title" class="flex-grow">Find Your Favorite Kalam</h2>
            <button id="NaatLyrics-search-close-btn" class="NaatLyrics-top-bar-button"><i
                    class="bi bi-x text-3xl"></i></button>
        </div>
        <div class="NaatLyrics-search-input-container">
            <input type="text" id="NaatLyrics-search-input" class="NaatLyrics-search-input"
                placeholder="Search for title or shayar...">
        </div>
        <!-- Search Chips Container -->
        <div id="NaatLyrics-search-chips-container" class="py-4 flex flex-wrap gap-2 justify-center"></div>
        <div id="NaatLyrics-search-results" class="NaatLyrics-search-popup-content space-y-3"></div>
    </div>


    <!-- <script>
    document.addEventListener('DOMContentLoaded', () => {
    const API_ENDPOINT = 'https://updated-naatacademy.onrender.com/api/romankalam/paged';
    const mainContainer = document.querySelector('main');
    const bottomNav = document.querySelector('.NaatLyrics-bottom-nav');
    const pages = document.querySelectorAll('.NaatLyrics-page');
    const backButton = document.getElementById('NaatLyrics-back-button');
    const brandHeader = document.getElementById('NaatLyrics-brand');
    const storyViewer = document.getElementById('NaatLyrics-story-viewer');
    const searchPopup = document.getElementById('NaatLyrics-search-popup');
    const searchIconBtn = document.getElementById('NaatLyrics-search-icon-btn');
    const searchCloseBtn = document.getElementById('NaatLyrics-search-close-btn');
    const searchInput = document.getElementById('NaatLyrics-search-input');
    const searchChipsContainer = document.getElementById('NaatLyrics-search-chips-container');

    const categoryEmojis = { 'Kalam': '📜', 'Naat': '📗', 'Manqabat': '📙', 'Hamd': '📒', 'Salam': '📘', 'Munajat': '📕', 'Tazmeen': '📓', 'Default': '📜' };
    const topicGradients = {
        "Yaad-e-Madinah": 'linear-gradient(45deg, #2563eb, #60a5fa)',
        "Shaan-e-Mustafa": 'linear-gradient(45deg, #059669, #34d399)',
        "Jashn-e-Milad": 'linear-gradient(45deg, #d97706, #f59e0b)',
        "Munajat": 'linear-gradient(45deg, #991b1b, #ef4444)',
        "Ishq-e-Rasool": 'linear-gradient(45deg, #db2777, #f472b6)',
        "Default": 'linear-gradient(45deg, #e0c3fc 0%, #8ec5fc 100%)'
    };

    let kalamData = [];
    let featuredStoryList = [];
    let currentStoryIndex = 0;
    let pageHistory = ['majmua'];
    let storyTimeout;

    const popularKeywords = [
        "Jashn-e-Milad",
        "Shaan-e-Mustafa",
        "Kalam e Aalahazrat",
        "Naghmat e Akhtar",
        "Allama Hasan Raza",
        "Qasida",
        "Durood o Naat",
        "Yaad-e-Madinah",
        "Hazri Darbar e Rislat",
        "Manqabat e Siddiq e Akbar",
        "Manqab e Maula Ali"
    ];

    // Utility functions for saved kalams in local storage
    const getSavedKalams = () => JSON.parse(localStorage.getItem('savedKalams')) || [];
    const saveKalam = (id) => {
        let s = getSavedKalams();
        if (!s.includes(id)) {
            s.push(id);
            localStorage.setItem('savedKalams', JSON.stringify(s));
        }
    };
    const unsaveKalam = (id) => {
        let s = getSavedKalams();
        localStorage.setItem('savedKalams', JSON.stringify(s.filter(i => i !== id)));
    };
    const isKalamSaved = (id) => getSavedKalams().includes(id);

    const formatCount = (n) => (n >= 1000) ? `${(n / 1000).toFixed(1)}k` : n;

    // Fetch kalam data dynamically from your API
    async function fetchKalamData(limit = 100) {
        try {
            const response = await fetch(`${API_ENDPOINT}?limit=${limit}&offset=0`);
            if (!response.ok) throw new Error('Failed to fetch kalam data');
            const data = await response.json();
            // Convert DB schema fields to your app's expected structure
            return data.map(k => ({
                id: k.id,
                title: k.Title,
                shayar: k.Book_Name,       // Adjust if you use real author field
                book: k.Book_Name,
                category: k.Category,
                topic: k.Topic,
                topKalam: k.topKalam || false, // Use logic to decide if something is a top kalam
                lyrics: k.Kalam_Post
            }));
        } catch (e) {
            console.error(e);
            return [];
        }
    }

    const getCountForKeyword = (keyword) => {
        const q = keyword.toLowerCase();
        return kalamData.filter(k =>
            k.title.toLowerCase().includes(q) ||
            k.shayar.toLowerCase().includes(q) ||
            k.topic.toLowerCase().includes(q) ||
            k.book.toLowerCase().includes(q) ||
            k.category.toLowerCase().includes(q)
        ).length;
    };

    // ----------- UI Rendering Utilities -----------

    const renderKalamList = (data, container) => {
        container.innerHTML = !data.length
            ? `<p class="text-center text-gray-500 mt-4">No Kalam found.</p>`
            : data.map((k, i) => {
                const viewCount = formatCount(Math.floor(Math.random() * 14001) + 10000);
                return `
                    <a href="#" class="NaatLyrics-qalam-item flex items-center" data-id="${k.id}" style="animation-delay: ${i * 30}ms;">
                        <div class="NaatLyrics-qalam-emoji">${categoryEmojis[k.category] || '📜'}</div>
                        <div class="flex-grow">
                            <div class="NaatLyrics-labels-container">
                                <span class="NaatLyrics-category-label qalam-cat-${k.category?.toLowerCase() || 'default'}">${k.category}</span>
                                <span class="text-gray-300">/</span>
                                <span class="NaatLyrics-topic-label" style="background-image: ${topicGradients[k.topic] || topicGradients['Default']}">${k.topic}</span>
                            </div>
                            <h2 class="NaatLyrics-qalam-title">${k.title}</h2>
                            <p class="text-sm text-gray-600 font-semibold">${k.shayar}</p>
                        </div>
                        <div class="NaatLyrics-qalam-view-count">👁️ ${viewCount}</div>
                    </a>`;
            }).join('');
    };

    const setupSlider = () => {
        const track = document.getElementById('NaatLyrics-slider-track');
        // Take first 6 naats as "top" for now -- or build logic as needed
        const featured = kalamData.filter(k => k.topKalam || true).slice(0, 6); // .topKalam if field, otherwise use your own filter
        featuredStoryList = featured.map(k => ({ ...k }));
        const gradients = [
            'linear-gradient(45deg, #065f46, #10b981)',
            'linear-gradient(45deg, #4f46e5, #818cf8)',
            'linear-gradient(45deg, #be123c, #fb7185)',
            'linear-gradient(45deg, #b45309, #f97316)',
            'linear-gradient(45deg, #4c1d95, #8b5cf6)',
            'linear-gradient(45deg, #9f1239, #ec4899)'
        ];

        track.innerHTML = featuredStoryList.map((k, i) => `
            <div class="NaatLyrics-slider-card" data-index="${i}">
                <div class="NaatLyrics-slider-card-inner" style="background-image: ${gradients[i % gradients.length]}">
                    <div class="NaatLyrics-slider-card-labels"><span>${k.category}</span> / <span>${k.topic}</span></div>
                    <div>
                        <h3 class="NaatLyrics-slider-card-title">${k.title}</h3>
                        <p class="NaatLyrics-slider-card-shayar">${k.shayar}</p>
                    </div>
                </div>
            </div>
        `).join('');
    };

    // Story Viewer Section
    const showStory = (k, isSeq = false) => {
        const content = document.getElementById('NaatLyrics-story-content');
        let likes = Math.floor(Math.random() * 5000) + 1000;
        let storyLinesArr = (k.lyrics || '').split('\n').filter(Boolean);
        let firstTwoLines = storyLinesArr.slice(0, 2).join('<br>');

        // Progress bars (support for multiple stories)
        content.innerHTML = `
            <div class="NaatLyrics-story-progress-container">${featuredStoryList.map((_,i)=>
                `<div class="NaatLyrics-story-progress-bar ${i===currentStoryIndex?'active':''}"><div class="NaatLyrics-story-progress-bar-inner"></div></div>`).join('')}
            </div>
            <div id="NaatLyrics-story-close" class="NaatLyrics-story-close">&times;</div>
            <div class="NaatLyrics-story-topic-chip">${k.topic}</div>
            <div class="NaatLyrics-story-lyrics">${firstTwoLines}</div>
            <div class="NaatLyrics-story-meta">
              
                <p><strong>Book:</strong> ${k.book}</p>
            </div>
            <div class="NaatLyrics-story-actions">
                <button id="NaatLyrics-story-like-btn">❤️ <span id="like-count">${likes}</span></button>
                <span class="opacity-80">|</span>
                <span>👁️ ${formatCount(Math.floor(Math.random()*10000)+2000)}</span>
            </div>
            <div class="NaatLyrics-story-bottom-bar">
                <button class="NaatLyrics-story-share-btn">Share All</button>
                <button class="NaatLyrics-story-share-btn">Share on WhatsApp</button>
            </div>
        `;
        storyViewer.classList.add('active');
        content.querySelector('#NaatLyrics-story-close').addEventListener('click', closeStory);
        content.querySelector('#NaatLyrics-story-like-btn').addEventListener('click', e => {
            e.currentTarget.querySelector('#like-count').innerText = parseInt(e.currentTarget.querySelector('#like-count').innerText) + 1;
        });

        clearTimeout(storyTimeout);
        if (isSeq) {
            setTimeout(() => {
                const bar = content.querySelector('.active .NaatLyrics-story-progress-bar-inner');
                if(bar) bar.style.transition = 'width 5s linear';
            }, 50);
            storyTimeout = setTimeout(() => {
                currentStoryIndex++;
                if (currentStoryIndex >= featuredStoryList.length) closeStory();
                else showStory(featuredStoryList[currentStoryIndex], true);
            }, 5000);
        }
    };

    const closeStory = () => {
        clearTimeout(storyTimeout);
        storyViewer.classList.remove('active');
    };

    // Sorting, category, topic, writers renderers
    const setupSorters = () => {
        const alphaSorter = document.getElementById('NaatLyrics-alphabet-sorter'),
            trendSorter = document.getElementById('NaatLyrics-trending-topics'),
            tabs = document.querySelector('.NaatLyrics-sorter-tabs'),
            panes = document.querySelectorAll('.NaatLyrics-tab-pane');

        alphaSorter.innerHTML = ['Top', 'All', ...'ABCDEFGHIJKLMNOPQRSTUVWXYZ']
            .map(l => `<button class="NaatLyrics-alpha-button ${l === 'All' ? 'active' : ''}" data-letter="${l}">${l}</button>`).join('');

        const topics = ["All", ...popularKeywords];
        trendSorter.innerHTML = topics.map(t =>
            `<button class="NaatLyrics-trending-topic" data-topic="${t}" style="background-image: ${(topicGradients[t] || topicGradients['Default'])}">
                ${t} <span class="count">${t === 'All' ? kalamData.length : getCountForKeyword(t)}</span>
            </button>`
        ).join('');

        tabs.addEventListener('click', e => {
            const btn = e.target.closest('.NaatLyrics-tab-button');
            if (!btn) return;
            document.querySelector('.NaatLyrics-tab-button.active').classList.remove('active');
            btn.classList.add('active');
            panes.forEach(p => p.classList.remove('active'));
            document.getElementById(`NaatLyrics-${btn.dataset.tab}-pane`).classList.add('active');
        });

        const filterList = (el, type, value) => {
            document.querySelector('.NaatLyrics-alpha-button.active')?.classList.remove('active');
            document.querySelector('.NaatLyrics-trending-topic.active')?.classList.remove('active');
            el.classList.add('active');
            let data;
            if (type === 'letter') {
                if (value === 'All') data = kalamData;
                else if (value === 'Top') data = kalamData.filter(k => k.topKalam || true); // adjust logic for .topKalam
                else {
                    const upperVal = value.toUpperCase();
                    data = kalamData.filter(k => k.title.toUpperCase().startsWith(upperVal));
                }
            } else {
                if (value === 'All') data = kalamData;
                else {
                    const q = value.toLowerCase();
                    data = kalamData.filter(k =>
                        k.title.toLowerCase().includes(q) ||
                        k.shayar.toLowerCase().includes(q) ||
                        k.topic.toLowerCase().includes(q) ||
                        k.book.toLowerCase().includes(q) ||
                        k.category.toLowerCase().includes(q)
                    );
                }
            }
            renderKalamList(data, document.getElementById('NaatLyrics-qalam-list'));
        };

        alphaSorter.addEventListener('click', e => {
            const btn = e.target.closest('.NaatLyrics-alpha-button');
            if (btn) filterList(btn, 'letter', btn.dataset.letter);
        });
        trendSorter.addEventListener('click', e => {
            const btn = e.target.closest('.NaatLyrics-trending-topic');
            if (btn) filterList(btn, 'topic', btn.dataset.topic);
        });
    };

    const renderCategoryList = () => {
        const container = document.getElementById('NaatLyrics-category-list');
        const categories = [...new Set(kalamData.map(k => k.category))];
        container.innerHTML = categories.map(cat =>
            `<div class="NaatLyrics-list-item font-bold text-lg">${cat}</div>`).join('');
    };

    const renderTopicList = () => {
        const container = document.getElementById('NaatLyrics-topic-list');
        const topics = [...new Set(kalamData.map(k => k.topic))];
        container.innerHTML = topics.map(topic =>
            `<div class="NaatLyrics-list-item font-bold text-lg">${topic}</div>`).join('');
    };

    const renderWriterList = () => {
        const container = document.getElementById('NaatLyrics-writer-list');
        // Group by writer
        const writers = kalamData.reduce((acc, k) => {
            if (!acc[k.shayar]) acc[k.shayar] = { books: new Set(), count: 0 };
            acc[k.shayar].books.add(k.book);
            acc[k.shayar].count++;
            return acc;
        }, {});
        container.innerHTML = Object.entries(writers).map(([writer, data]) =>
            `<div class="NaatLyrics-list-item flex justify-between items-center">
                <div>
                    <h3 class="font-bold text-lg">✍️ ${writer}</h3>
                    <p class="text-sm text-gray-600 font-semibold mt-1">📚 ${[...data.books].join(', ')}</p>
                </div>
                <span class="text-xs font-bold text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${data.count} Kalams</span>
            </div>`
        ).join('');
    };

    // Kalam Detail View
    const showKalamDetailPage = (id) => {
        const k = kalamData.find(item => item.id === id);
        if (!k) return;
        const saved = isKalamSaved(k.id);
        const title = `"${k.title}" Lyrics - by ${k.shayar} | Naat Academy`;
        const description = `Read the complete lyrics for "${k.title}" from the book ${k.book}, written by ${k.shayar}. Available on Naat Academy.`;
        document.title = title;

        // Set meta description for SEO
        const descTag = document.querySelector('meta[name="description"]');
        if (descTag) descTag.setAttribute('content', description);
        // Add Open Graph/Twitter cards as needed...

        document.getElementById('NaatLyrics-qalam-detail-content').innerHTML = `
            <h2 class="text-3xl font-extrabold mb-4 text-center NaatLyrics-detail-title">${k.title}</h2>
            <div class="flex justify-center items-center gap-4 mb-4 text-sm text-gray-500 font-semibold">
                <span>${categoryEmojis[k.category] || '📜'} ${k.category}</span>
                <span><i class="bi bi-person-fill"></i> ${k.shayar}</span>
                <span><i class="bi bi-book-fill"></i> ${k.book}</span>
            </div>
            <div class="NaatLyrics-detail-actions">
                <button class="NaatLyrics-action-btn font-urdu">اردو کلام</button>
                <button id="NaatLyrics-save-kalam-btn" data-id="${k.id}" class="${saved ? 'saved' : ''}"><i class="bi ${saved ? 'bi-heart-fill' : 'bi-heart'}"></i> ${saved ? 'Saved' : 'Save'}</button>
                <button id="NaatLyrics-share-kalam-btn" data-id="${k.id}"><i class="bi bi-share-fill"></i> Share</button>
            </div>
            <div class="NaatLyrics-qalam-pane">${k.lyrics.replace(/\n/g, '<br>')}</div>
        `;
        document.getElementById('NaatLyrics-save-kalam-btn').addEventListener('click', e => {
            const btn = e.currentTarget, id = parseInt(btn.dataset.id);
            if (isKalamSaved(id)) {
                unsaveKalam(id);
                btn.innerHTML = '<i class="bi bi-heart"></i> Save';
                btn.classList.remove('saved');
            } else {
                saveKalam(id);
                btn.innerHTML = '<i class="bi bi-heart-fill"></i> Saved';
                btn.classList.add('saved');
            }
        });
        document.getElementById('NaatLyrics-share-kalam-btn').addEventListener('click', e => {
            const id = parseInt(e.currentTarget.dataset.id);
            const kalam = kalamData.find(item => item.id === id);
            if (navigator.share) {
                navigator.share({
                    title: `${kalam.title} - Naat Academy`,
                    text: `Read the beautiful kalam "${kalam.title}" by ${kalam.shayar} on Naat Academy.\n\n${kalam.lyrics.substring(0, 100)}...`,
                    url: window.location.href,
                });
            } else {
                const shareText = `${kalam.title} - by ${kalam.shayar}\n\n${kalam.lyrics}`;
                navigator.clipboard.writeText(shareText).then(() => {
                   alert('Kalam copied to clipboard!');
                });
            }
        });
        switchPage('qalam-detail', true);
    };

    // Switch pages helper
    const switchPage = (id, isDetail = false) => {
        pages.forEach(p => p.classList.remove('active'));
        document.getElementById(`NaatLyrics-page-${id}`)?.classList.add('active');
        let title = "Naat Academy";
        switch (id) {
            case 'category': title = "Categories"; renderCategoryList(); break;
            case 'topics': title = "Topics"; renderTopicList(); break;
            case 'writers': title = "Writers"; renderWriterList(); break;
            case 'saved': title = "Saved Kalams"; renderKalamList(kalamData.filter(k => isKalamSaved(k.id)), document.getElementById('NaatLyrics-saved-list')); break;
        }
        backButton.classList.toggle('hidden', !isDetail);
        brandHeader.classList.toggle('hidden', isDetail);
        if (!isDetail) {
            pageHistory = [id];
            document.querySelector('.NaatLyrics-bottom-nav-item.active')?.classList.remove('active');
            document.querySelector(`.NaatLyrics-bottom-nav-item[data-page="${id}"]`)?.classList.add('active');
        } else if (pageHistory[pageHistory.length - 1] !== id) {
            pageHistory.push(id);
        }
    };

    // Render search chips for popular keywords
    const renderSearchChips = () => {
        searchChipsContainer.innerHTML = popularKeywords.map(keyword =>
            `<button class="NaatLyrics-search-chip">${keyword}</button>`).join('');
    };

    //--------------------------------------------------------
    // Event Listeners & User Interactions
    //--------------------------------------------------------
    backButton.addEventListener('click', () => {
        pageHistory.pop();
        const prevPage = pageHistory[pageHistory.length - 1] || 'majmua';
        switchPage(prevPage);
    });

    bottomNav.addEventListener('click', e => {
        const item = e.target.closest('.NaatLyrics-bottom-nav-item');
        if (item) switchPage(item.dataset.page);
    });

    mainContainer.addEventListener('click', e => {
        const item = e.target.closest('.NaatLyrics-qalam-item');
        if (item) {
            e.preventDefault();
            showKalamDetailPage(parseInt(item.dataset.id));
        }
    });

    // Slider click for story
    document.getElementById('NaatLyrics-slider-track').addEventListener('click', e => {
        const card = e.target.closest('.NaatLyrics-slider-card');
        if (card) {
            currentStoryIndex = parseInt(card.dataset.index);
            showStory(featuredStoryList[currentStoryIndex], true);
        }
    });

    searchIconBtn.addEventListener('click', () => searchPopup.classList.add('active'));
    searchCloseBtn.addEventListener('click', () => searchPopup.classList.remove('active'));
    searchInput.addEventListener('input', e => {
        const q = e.target.value.toLowerCase();
        const results = q.length < 1 ? [] : kalamData.filter(k =>
            k.title.toLowerCase().includes(q) ||
            k.shayar.toLowerCase().includes(q) ||
            k.topic.toLowerCase().includes(q) ||
            k.book.toLowerCase().includes(q) ||
            k.category.toLowerCase().includes(q)
        );
        renderKalamList(results, document.getElementById('NaatLyrics-search-results'));
    });

    searchChipsContainer.addEventListener('click', e => {
        const chip = e.target.closest('.NaatLyrics-search-chip');
        if (chip) {
            searchInput.value = chip.textContent;
            searchInput.dispatchEvent(new Event('input', { bubbles: true }));
            searchInput.focus();
        }
    });

    //--------------------------------------------------------
    // Initial App Load
    //--------------------------------------------------------
    async function init() {
        kalamData = await fetchKalamData();
        // If your API response does not have .topKalam, use logic to define top stories
        // e.g. mark first 6 as topKalam for story slider
        kalamData.sort((a, b) => a.title.localeCompare(b.title));
        setupSlider();
        setupSorters();
        renderKalamList(kalamData, document.getElementById('NaatLyrics-qalam-list'));
        renderSearchChips();
        document.querySelector('.NaatLyrics-tab-button[data-tab="trending"]')?.click();
        // Set "All" trending topic to be active on load
        const allTrendingTopic = document.querySelector('.NaatLyrics-trending-topic[data-topic="All"]');
        if(allTrendingTopic) allTrendingTopic.click();
    }

    init();
});

   </script> -->


    <!-- <script>
        document.addEventListener('DOMContentLoaded', () => {
            const API_ENDPOINT = 'https://updated-naatacademy.onrender.com/api/romankalam/paged';
            const mainContainer = document.querySelector('main');
            const bottomNav = document.querySelector('.NaatLyrics-bottom-nav');
            const pages = document.querySelectorAll('.NaatLyrics-page');
            const backButton = document.getElementById('NaatLyrics-back-button');
            const brandHeader = document.getElementById('NaatLyrics-brand');
            const storyViewer = document.getElementById('NaatLyrics-story-viewer');
            const searchPopup = document.getElementById('NaatLyrics-search-popup');
            const searchIconBtn = document.getElementById('NaatLyrics-search-icon-btn');
            const searchCloseBtn = document.getElementById('NaatLyrics-search-close-btn');
            const searchInput = document.getElementById('NaatLyrics-search-input');
            const searchChipsContainer = document.getElementById('NaatLyrics-search-chips-container');
            const searchResultsContainer = document.getElementById('NaatLyrics-search-results');

            const categoryEmojis = { 'Kalam': '📜', 'Naat': '📗', 'Manqabat': '📙', 'Hamd': '📒', 'Salam': '📘', 'Munajat': '📕', 'Tazmeen': '📓', 'Default': '📜' };
            const topicGradients = {
                "Yaad-e-Madinah": 'linear-gradient(45deg, #2563eb, #60a5fa)',
                "Shaan-e-Mustafa": 'linear-gradient(45deg, #059669, #34d399)',
                "Jashn-e-Milad": 'linear-gradient(45deg, #d97706, #f59e0b)',
                "Munajat": 'linear-gradient(45deg, #991b1b, #ef4444)',
                "Ishq-e-Rasool": 'linear-gradient(45deg, #db2777, #f472b6)',
                "Default": 'linear-gradient(45deg, #e0c3fc 0%, #8ec5fc 100%)'
            };

            let kalamData = [];
            let featuredStoryList = [];
            let currentStoryIndex = 0;
            let pageHistory = ['majmua'];
            let storyTimeout;

            const popularKeywords = [
                "Jashn-e-Milad",
                "Shaan-e-Mustafa",
                "Kalam e Aalahazrat",
                "Naghmat e Akhtar",
                "Allama Hasan Raza",
                "Qasida",
                "Durood o Naat",
                "Yaad-e-Madinah",
                "Hazri Darbar e Rislat",
                "Manqabat e Siddiq e Akbar",
                "Manqab e Maula Ali"
            ];

            // Utility functions for saved kalams in local storage
            const getSavedKalams = () => JSON.parse(localStorage.getItem('savedKalams')) || [];
            const saveKalam = (id) => {
                let s = getSavedKalams();
                if (!s.includes(id)) {
                    s.push(id);
                    localStorage.setItem('savedKalams', JSON.stringify(s));
                }
            };
            const unsaveKalam = (id) => {
                let s = getSavedKalams();
                localStorage.setItem('savedKalams', JSON.stringify(s.filter(i => i !== id)));
            };
            const isKalamSaved = (id) => getSavedKalams().includes(id);

            const formatCount = (n) => (n >= 1000) ? `${(n / 1000).toFixed(1)}k` : n;

            // Fetch kalam data dynamically from your API
            async function fetchKalamData(limit = 100) {
                try {
                    const response = await fetch(`${API_ENDPOINT}?limit=${limit}&offset=0`);
                    if (!response.ok) throw new Error('Failed to fetch kalam data');
                    const data = await response.json();
                    // Convert DB schema fields to your app's expected structure
                    return data.map(k => ({
                        id: k.id,
                        title: k.Title,
                        shayar: k.Book_Name,       // Adjust if you use real author field
                        book: k.Book_Name,
                        category: k.Category,
                        topic: k.Topic,
                        topKalam: k.topKalam || false, // Use logic to decide if something is a top kalam
                        lyrics: k.Kalam_Post
                    }));
                } catch (e) {
                    console.error(e);
                    return [];
                }
            }

            const getCountForKeyword = (keyword) => {
                const q = keyword.toLowerCase();
                return kalamData.filter(k =>
                    k.title.toLowerCase().includes(q) ||
                    k.shayar.toLowerCase().includes(q) ||
                    k.topic.toLowerCase().includes(q) ||
                    k.book.toLowerCase().includes(q) ||
                    k.category.toLowerCase().includes(q)
                ).length;
            };

            // ----------- UI Rendering Utilities -----------

            const renderKalamList = (data, container) => {
                container.innerHTML = !data.length
                    ? `<p class="text-center text-gray-500 mt-4">No Kalam found.</p>`
                    : data.map((k, i) => {
                        const viewCount = formatCount(Math.floor(Math.random() * 14001) + 10000);
                        return `
                    <a href="#" class="NaatLyrics-qalam-item flex items-center" data-id="${k.id}" style="animation-delay: ${i * 30}ms;">
                        <div class="NaatLyrics-qalam-emoji">${categoryEmojis[k.category] || '📜'}</div>
                        <div class="flex-grow">
                            <div class="NaatLyrics-labels-container">
                                <span class="NaatLyrics-category-label qalam-cat-${k.category?.toLowerCase() || 'default'}">${k.category}</span>
                                <span class="text-gray-300">/</span>
                                <span class="NaatLyrics-topic-label" style="background-image: ${topicGradients[k.topic] || topicGradients['Default']}">${k.topic}</span>
                            </div>
                            <h2 class="NaatLyrics-qalam-title">${k.title}</h2>
                            <p class="text-sm text-gray-600 font-semibold">${k.shayar}</p>
                        </div>
                        <div class="NaatLyrics-qalam-view-count">👁️ ${viewCount}</div>
                    </a>`;
                    }).join('');

                // Add event listeners to all kalam items
                container.querySelectorAll('.NaatLyrics-qalam-item').forEach(item => {
                    item.addEventListener('click', function (e) {
                        e.preventDefault();
                        showKalamDetailPage(parseInt(this.dataset.id));
                    });
                });
            };

            const setupSlider = () => {
                const track = document.getElementById('NaatLyrics-slider-track');
                // Take first 6 naats as "top" for now -- or build logic as needed
                const featured = kalamData.filter(k => k.topKalam || true).slice(0, 6); // .topKalam if field, otherwise use your own filter
                featuredStoryList = featured.map(k => ({ ...k }));
                const gradients = [
                    'linear-gradient(45deg, #065f46, #10b981)',
                    'linear-gradient(45deg, #4f46e5, #818cf8)',
                    'linear-gradient(45deg, #be123c, #fb7185)',
                    'linear-gradient(45deg, #b45309, #f97316)',
                    'linear-gradient(45deg, #4c1d95, #8b5cf6)',
                    'linear-gradient(45deg, #9f1239, #ec4899)'
                ];

                track.innerHTML = featuredStoryList.map((k, i) => `
            <div class="NaatLyrics-slider-card" data-index="${i}">
                <div class="NaatLyrics-slider-card-inner" style="background-image: ${gradients[i % gradients.length]}">
                    <div class="NaatLyrics-slider-card-labels"><span>${k.category}</span> / <span>${k.topic}</span></div>
                    <div>
                        <h3 class="NaatLyrics-slider-card-title">${k.title}</h3>
                        <p class="NaatLyrics-slider-card-shayar">${k.shayar}</p>
                    </div>
                </div>
            </div>
        `).join('');
            };

            // Story Viewer Section
            const showStory = (k, isSeq = false) => {
                const content = document.getElementById('NaatLyrics-story-content');
                let likes = Math.floor(Math.random() * 5000) + 1000;
                let storyLinesArr = (k.lyrics || '').split('\n').filter(Boolean);
                let firstTwoLines = storyLinesArr.slice(0, 2).join('<br>');

                // Progress bars (support for multiple stories)
                content.innerHTML = `
            <div class="NaatLyrics-story-progress-container">${featuredStoryList.map((_, i) =>
                    `<div class="NaatLyrics-story-progress-bar ${i === currentStoryIndex ? 'active' : ''}"><div class="NaatLyrics-story-progress-bar-inner"></div></div>`).join('')}
            </div>
            <div id="NaatLyrics-story-close" class="NaatLyrics-story-close">&times;</div>
            <div class="NaatLyrics-story-topic-chip">${k.topic}</div>
            <div class="NaatLyrics-story-lyrics">${firstTwoLines}</div>
            <div class="NaatLyrics-story-meta">
              
                <p><strong>Book:</strong> ${k.book}</p>
            </div>
            <div class="NaatLyrics-story-actions">
                <button id="NaatLyrics-story-like-btn">❤️ <span id="like-count">${likes}</span></button>
                <span class="opacity-80">|</span>
                <span>👁️ ${formatCount(Math.floor(Math.random() * 10000) + 2000)}</span>
            </div>
            <div class="NaatLyrics-story-bottom-bar">
                <button class="NaatLyrics-story-share-btn">Share All</button>
                <button class="NaatLyrics-story-share-btn">Share on WhatsApp</button>
            </div>
        `;
                storyViewer.classList.add('active');
                content.querySelector('#NaatLyrics-story-close').addEventListener('click', closeStory);
                content.querySelector('#NaatLyrics-story-like-btn').addEventListener('click', e => {
                    e.currentTarget.querySelector('#like-count').innerText = parseInt(e.currentTarget.querySelector('#like-count').innerText) + 1;
                });

                clearTimeout(storyTimeout);
                if (isSeq) {
                    setTimeout(() => {
                        const bar = content.querySelector('.active .NaatLyrics-story-progress-bar-inner');
                        if (bar) bar.style.transition = 'width 5s linear';
                    }, 50);
                    storyTimeout = setTimeout(() => {
                        currentStoryIndex++;
                        if (currentStoryIndex >= featuredStoryList.length) closeStory();
                        else showStory(featuredStoryList[currentStoryIndex], true);
                    }, 5000);
                }
            };

            const closeStory = () => {
                clearTimeout(storyTimeout);
                storyViewer.classList.remove('active');
            };

            // Sorting, category, topic, writers renderers
            const setupSorters = () => {
                const alphaSorter = document.getElementById('NaatLyrics-alphabet-sorter'),
                    trendSorter = document.getElementById('NaatLyrics-trending-topics'),
                    tabs = document.querySelector('.NaatLyrics-sorter-tabs'),
                    panes = document.querySelectorAll('.NaatLyrics-tab-pane');

                alphaSorter.innerHTML = ['Top', 'All', ...'ABCDEFGHIJKLMNOPQRSTUVWXYZ']
                    .map(l => `<button class="NaatLyrics-alpha-button ${l === 'All' ? 'active' : ''}" data-letter="${l}">${l}</button>`).join('');

                const topics = ["All", ...popularKeywords];
                trendSorter.innerHTML = topics.map(t =>
                    `<button class="NaatLyrics-trending-topic" data-topic="${t}" style="background-image: ${(topicGradients[t] || topicGradients['Default'])}">
                ${t} <span class="count">${t === 'All' ? kalamData.length : getCountForKeyword(t)}</span>
            </button>`
                ).join('');

                tabs.addEventListener('click', e => {
                    const btn = e.target.closest('.NaatLyrics-tab-button');
                    if (!btn) return;
                    document.querySelector('.NaatLyrics-tab-button.active').classList.remove('active');
                    btn.classList.add('active');
                    panes.forEach(p => p.classList.remove('active'));
                    document.getElementById(`NaatLyrics-${btn.dataset.tab}-pane`).classList.add('active');
                });

                const filterList = (el, type, value) => {
                    document.querySelector('.NaatLyrics-alpha-button.active')?.classList.remove('active');
                    document.querySelector('.NaatLyrics-trending-topic.active')?.classList.remove('active');
                    el.classList.add('active');
                    let data;
                    if (type === 'letter') {
                        if (value === 'All') data = kalamData;
                        else if (value === 'Top') data = kalamData.filter(k => k.topKalam || true); // adjust logic for .topKalam
                        else {
                            const upperVal = value.toUpperCase();
                            data = kalamData.filter(k => k.title.toUpperCase().startsWith(upperVal));
                        }
                    } else {
                        if (value === 'All') data = kalamData;
                        else {
                            const q = value.toLowerCase();
                            data = kalamData.filter(k =>
                                k.title.toLowerCase().includes(q) ||
                                k.shayar.toLowerCase().includes(q) ||
                                k.topic.toLowerCase().includes(q) ||
                                k.book.toLowerCase().includes(q) ||
                                k.category.toLowerCase().includes(q)
                            );
                        }
                    }
                    renderKalamList(data, document.getElementById('NaatLyrics-qalam-list'));
                };

                alphaSorter.addEventListener('click', e => {
                    const btn = e.target.closest('.NaatLyrics-alpha-button');
                    if (btn) filterList(btn, 'letter', btn.dataset.letter);
                });
                trendSorter.addEventListener('click', e => {
                    const btn = e.target.closest('.NaatLyrics-trending-topic');
                    if (btn) filterList(btn, 'topic', btn.dataset.topic);
                });
            };

            const renderCategoryList = () => {
                const container = document.getElementById('NaatLyrics-category-list');
                const categories = [...new Set(kalamData.map(k => k.category))];
                container.innerHTML = categories.map(cat =>
                    `<div class="NaatLyrics-list-item font-bold text-lg">${cat}</div>`).join('');
            };

            const renderTopicList = () => {
                const container = document.getElementById('NaatLyrics-topic-list');

                // Count kalams per topic
                const topicCounts = kalamData.reduce((acc, k) => {
                    acc[k.topic] = (acc[k.topic] || 0) + 1;
                    return acc;
                }, {});

                // Get unique topics sorted by count (descending)
                const topics = Object.keys(topicCounts).sort((a, b) => topicCounts[b] - topicCounts[a]);

                container.innerHTML = topics.map(topic => `
        <div class="NaatLyrics-list-item flex justify-between items-center" data-topic="${topic}">
            <span class="font-bold text-lg">${topic}</span>
            <span class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
                ${topicCounts[topic]} Kalams
            </span>
        </div>
    `).join('');

                // Add click event listeners to each topic item
                container.querySelectorAll('.NaatLyrics-list-item').forEach(item => {
                    item.addEventListener('click', function () {
                        const topic = this.dataset.topic;

                        // Switch to majmua page
                        switchPage('majmua');

                        // Wait a moment for the page to switch, then filter by topic
                        setTimeout(() => {
                            // Find and click the trending topic button for this topic
                            const topicButton = document.querySelector(`.NaatLyrics-trending-topic[data-topic="${topic}"]`);

                            if (topicButton) {
                                topicButton.click();
                            } else {
                                // If specific topic button doesn't exist, just show all kalams
                                document.querySelector('.NaatLyrics-trending-topic[data-topic="All"]')?.click();
                            }
                        }, 100);
                    });
                });
            };
            const renderWriterList = () => {
                const container = document.getElementById('NaatLyrics-writer-list');
                // Group by writer
                const writers = kalamData.reduce((acc, k) => {
                    if (!acc[k.shayar]) acc[k.shayar] = { books: new Set(), count: 0 };
                    acc[k.shayar].books.add(k.book);
                    acc[k.shayar].count++;
                    return acc;
                }, {});
                container.innerHTML = Object.entries(writers).map(([writer, data]) =>
                    `<div class="NaatLyrics-list-item flex justify-between items-center">
                <div>
                    <h3 class="font-bold text-lg">✍️ ${writer}</h3>
                    <p class="text-sm text-gray-600 font-semibold mt-1">📚 ${[...data.books].join(', ')}</p>
                </div>
                <span class="text-xs font-bold text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${data.count} Kalams</span>
            </div>`
                ).join('');
            };

            // Kalam Detail View
            const showKalamDetailPage = (id) => {
                const k = kalamData.find(item => item.id === id);
                if (!k) return;
                const saved = isKalamSaved(k.id);
                const title = `"${k.title}" Lyrics - by ${k.shayar} | Naat Academy`;
                const description = `Read the complete lyrics for "${k.title}" from the book ${k.book}, written by ${k.shayar}. Available on Naat Academy.`;
                document.title = title;

                // Set meta description for SEO
                const descTag = document.querySelector('meta[name="description"]');
                if (descTag) descTag.setAttribute('content', description);
                // Add Open Graph/Twitter cards as needed...

                document.getElementById('NaatLyrics-qalam-detail-content').innerHTML = `
            <h2 class="text-3xl font-extrabold mb-4 text-center NaatLyrics-detail-title">${k.title}</h2>
            <div class="flex justify-center items-center gap-4 mb-4 text-sm text-gray-500 font-semibold">
                <span>${categoryEmojis[k.category] || '📜'} ${k.category}</span>
                <span><i class="bi bi-person-fill"></i> ${k.shayar}</span>
                <span><i class="bi bi-book-fill"></i> ${k.book}</span>
            </div>
            <div class="NaatLyrics-detail-actions">
                <button class="NaatLyrics-action-btn font-urdu">اردو کلام</button>
                <button id="NaatLyrics-save-kalam-btn" data-id="${k.id}" class="${saved ? 'saved' : ''}"><i class="bi ${saved ? 'bi-heart-fill' : 'bi-heart'}"></i> ${saved ? 'Saved' : 'Save'}</button>
                <button id="NaatLyrics-share-kalam-btn" data-id="${k.id}"><i class="bi bi-share-fill"></i> Share</button>
            </div>
            <div class="NaatLyrics-qalam-pane">${k.lyrics.replace(/\n/g, '<br>')}</div>
        `;
                document.getElementById('NaatLyrics-save-kalam-btn').addEventListener('click', e => {
                    const btn = e.currentTarget, id = parseInt(btn.dataset.id);
                    if (isKalamSaved(id)) {
                        unsaveKalam(id);
                        btn.innerHTML = '<i class="bi bi-heart"></i> Save';
                        btn.classList.remove('saved');
                    } else {
                        saveKalam(id);
                        btn.innerHTML = '<i class="bi bi-heart-fill"></i> Saved';
                        btn.classList.add('saved');
                    }
                });
                document.getElementById('NaatLyrics-share-kalam-btn').addEventListener('click', e => {
                    const id = parseInt(e.currentTarget.dataset.id);
                    const kalam = kalamData.find(item => item.id === id);
                    if (navigator.share) {
                        navigator.share({
                            title: `${kalam.title} - Naat Academy`,
                            text: `Read the beautiful kalam "${kalam.title}" by ${kalam.shayar} on Naat Academy.\n\n${kalam.lyrics.substring(0, 100)}...`,
                            url: window.location.href,
                        });
                    } else {
                        const shareText = `${kalam.title} - by ${kalam.shayar}\n\n${kalam.lyrics}`;
                        navigator.clipboard.writeText(shareText).then(() => {
                            alert('Kalam copied to clipboard!');
                        });
                    }
                });
                switchPage('qalam-detail', true);
            };

            // Switch pages helper
            const switchPage = (id, isDetail = false) => {
                pages.forEach(p => p.classList.remove('active'));
                document.getElementById(`NaatLyrics-page-${id}`)?.classList.add('active');
                let title = "Naat Academy";
                switch (id) {
                    case 'category': title = "Categories"; renderCategoryList(); break;
                    case 'topics': title = "Topics"; renderTopicList(); break;
                    case 'writers': title = "Writers"; renderWriterList(); break;
                    case 'saved': title = "Saved Kalams"; renderKalamList(kalamData.filter(k => isKalamSaved(k.id)), document.getElementById('NaatLyrics-saved-list')); break;
                }
                backButton.classList.toggle('hidden', !isDetail);
                brandHeader.classList.toggle('hidden', isDetail);
                if (!isDetail) {
                    pageHistory = [id];
                    document.querySelector('.NaatLyrics-bottom-nav-item.active')?.classList.remove('active');
                    document.querySelector(`.NaatLyrics-bottom-nav-item[data-page="${id}"]`)?.classList.add('active');
                } else if (pageHistory[pageHistory.length - 1] !== id) {
                    pageHistory.push(id);
                }
            };

            // Render search chips for popular keywords
            const renderSearchChips = () => {
                searchChipsContainer.innerHTML = popularKeywords.map(keyword =>
                    `<button class="NaatLyrics-search-chip">${keyword}</button>`).join('');
            };

            //--------------------------------------------------------
            // Event Listeners & User Interactions
            //--------------------------------------------------------
            backButton.addEventListener('click', () => {
                pageHistory.pop();
                const prevPage = pageHistory[pageHistory.length - 1] || 'majmua';
                switchPage(prevPage);
            });

            bottomNav.addEventListener('click', e => {
                const item = e.target.closest('.NaatLyrics-bottom-nav-item');
                if (item) switchPage(item.dataset.page);
            });

            mainContainer.addEventListener('click', e => {
                const item = e.target.closest('.NaatLyrics-qalam-item');
                if (item) {
                    e.preventDefault();
                    showKalamDetailPage(parseInt(item.dataset.id));
                }
            });

            // Slider click for story
            document.getElementById('NaatLyrics-slider-track').addEventListener('click', e => {
                const card = e.target.closest('.NaatLyrics-slider-card');
                if (card) {
                    currentStoryIndex = parseInt(card.dataset.index);
                    showStory(featuredStoryList[currentStoryIndex], true);
                }
            });

            searchIconBtn.addEventListener('click', () => searchPopup.classList.add('active'));
            searchCloseBtn.addEventListener('click', () => searchPopup.classList.remove('active'));
            searchInput.addEventListener('input', e => {
                const q = e.target.value.toLowerCase();
                const results = q.length < 1 ? [] : kalamData.filter(k =>
                    k.title.toLowerCase().includes(q) ||
                    k.shayar.toLowerCase().includes(q) ||
                    k.topic.toLowerCase().includes(q) ||
                    k.book.toLowerCase().includes(q) ||
                    k.category.toLowerCase().includes(q)
                );
                renderKalamList(results, searchResultsContainer);
            });

            searchChipsContainer.addEventListener('click', e => {
                const chip = e.target.closest('.NaatLyrics-search-chip');
                if (chip) {
                    searchInput.value = chip.textContent;
                    searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                    searchInput.focus();
                }
            });

            // Add event listener for search result items
            searchResultsContainer.addEventListener('click', e => {
                const item = e.target.closest('.NaatLyrics-qalam-item');
                if (item) {
                    e.preventDefault();
                    showKalamDetailPage(parseInt(item.dataset.id));
                    searchPopup.classList.remove('active');
                }
            });

            //--------------------------------------------------------
            // Initial App Load
            //--------------------------------------------------------
            async function init() {
                kalamData = await fetchKalamData();
                // If your API response does not have .topKalam, use logic to define top stories
                // e.g. mark first 6 as topKalam for story slider
                kalamData.sort((a, b) => a.title.localeCompare(b.title));
                setupSlider();
                setupSorters();
                renderKalamList(kalamData, document.getElementById('NaatLyrics-qalam-list'));
                renderSearchChips();
                document.querySelector('.NaatLyrics-tab-button[data-tab="trending"]')?.click();
                // Set "All" trending topic to be active on load
                const allTrendingTopic = document.querySelector('.NaatLyrics-trending-topic[data-topic="All"]');
                if (allTrendingTopic) allTrendingTopic.click();
            }

            init();
        });
    </script> -->


   <script>
    document.addEventListener('DOMContentLoaded', () => {
        const API_ENDPOINT = 'https://updated-naatacademy.onrender.com/api/romankalam/paged';
        const SEARCH_ENDPOINT = 'https://updated-naatacademy.onrender.com/api/romankalam/search';
        const mainContainer = document.querySelector('main');
        const bottomNav = document.querySelector('.NaatLyrics-bottom-nav');
        const pages = document.querySelectorAll('.NaatLyrics-page');
        const backButton = document.getElementById('NaatLyrics-back-button');
        const brandHeader = document.getElementById('NaatLyrics-brand');
        const storyViewer = document.getElementById('NaatLyrics-story-viewer');
        const searchPopup = document.getElementById('NaatLyrics-search-popup');
        const searchIconBtn = document.getElementById('NaatLyrics-search-icon-btn');
        const searchCloseBtn = document.getElementById('NaatLyrics-search-close-btn');
        const searchInput = document.getElementById('NaatLyrics-search-input');
        const searchChipsContainer = document.getElementById('NaatLyrics-search-chips-container');
        const searchResultsContainer = document.getElementById('NaatLyrics-search-results');

        const categoryEmojis = { 'Kalam': '📜', 'Naat': '📗', 'Manqabat': '📙', 'Hamd': '📒', 'Salam': '📘', 'Munajat': '📕', 'Tazmeen': '📓', 'Default': '📜' };
        const topicGradients = {
            "Yaad-e-Madinah": 'linear-gradient(45deg, #2563eb, #60a5fa)',
            "Shaan-e-Mustafa": 'linear-gradient(45deg, #059669, #34d399)',
            "Jashn-e-Milad": 'linear-gradient(45deg, #d97706, #f59e0b)',
            "Munajat": 'linear-gradient(45deg, #991b1b, #ef4444)',
            "Ishq-e-Rasool": 'linear-gradient(45deg, #db2777, #f472b6)',
            "Default": 'linear-gradient(45deg, #e0c3fc 0%, #8ec5fc 100%)'
        };

        let kalamData = [];
        let featuredStoryList = [];
        let currentStoryIndex = 0;
        let pageHistory = ['majmua'];
        let storyTimeout;
        let currentSearchResults = [];
        let allTopics = [];

        const popularKeywords = [
            "Jashn-e-Milad",
            "Shaan-e-Mustafa",
            "Kalam e Aalahazrat",
            "Naghmat e Akhtar",
            "Allama Hasan Raza",
            "Qasida",
            "Durood o Naat",
            "Yaad-e-Madinah",
            "Hazri Darbar e Rislat",
            "Manqabat e Siddiq e Akbar",
            "Manqab e Maula Ali"
        ];

        // Utility functions for saved kalams in local storage
        const getSavedKalams = () => JSON.parse(localStorage.getItem('savedKalams')) || [];
        const saveKalam = (id) => {
            let s = getSavedKalams();
            if (!s.includes(id)) {
                s.push(id);
                localStorage.setItem('savedKalams', JSON.stringify(s));
            }
        };
        const unsaveKalam = (id) => {
            let s = getSavedKalams();
            localStorage.setItem('savedKalams', JSON.stringify(s.filter(i => i !== id)));
        };
        const isKalamSaved = (id) => getSavedKalams().includes(id);

        const formatCount = (n) => (n >= 1000) ? `${(n / 1000).toFixed(1)}k` : n;

        // Function to generate slug from title
        const generateSlug = (title) => {
            return title
                .toLowerCase()
                .replace(/[^\w ]+/g, '')
                .replace(/ +/g, '-');
        };

        // Function to update URL with slug
        const updateURLWithSlug = (slug) => {
            const newURL = `${window.location.pathname}?kalam=${slug}`;
            window.history.pushState({ path: newURL }, '', newURL);
        };

        // Function to remove slug from URL
        const removeSlugFromURL = () => {
            window.history.pushState({}, '', window.location.pathname);
        };

        // Function to get kalam ID from slug in URL
        const getKalamIdFromSlug = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('kalam');
            if (!slug) return null;
            
            // Find kalam with matching slug
            const kalam = kalamData.find(k => generateSlug(k.title) === slug);
            return kalam ? kalam.id : null;
        };

        // Fetch kalam data dynamically from your API
        async function fetchKalamData(limit = 100) {
            try {
                const response = await fetch(`${API_ENDPOINT}?limit=${limit}&offset=0`);
                if (!response.ok) throw new Error('Failed to fetch kalam data');
                const data = await response.json();
                // Convert DB schema fields to your app's expected structure
                return data.map(k => ({
                    id: k.id,
                    title: k.Title,
                    shayar: k.Book_Name,       // Adjust if you use real author field
                    book: k.Book_Name,
                    category: k.Category,
                    topic: k.Topic,
                    topKalam: k.topKalam || false, // Use logic to decide if something is a top kalam
                    lyrics: k.Kalam_Post
                }));
            } catch (e) {
                console.error(e);
                return [];
            }
        }

        // Search kalams from API by title, book name, or topic
        async function searchKalamsFromAPI(searchTerm) {
            try {
                const response = await fetch(`${SEARCH_ENDPOINT}?q=${encodeURIComponent(searchTerm)}`);
                if (!response.ok) throw new Error('Failed to search kalams');
                const data = await response.json();
                
                // Convert DB schema fields to your app's expected structure
                return data.map(k => ({
                    id: k.id,
                    title: k.Title,
                    shayar: k.Book_Name,
                    book: k.Book_Name,
                    category: k.Category,
                    topic: k.Topic,
                    topKalam: k.topKalam || false,
                    lyrics: k.Kalam_Post
                }));
            } catch (e) {
                console.error('API search failed, falling back to local search:', e);
                // Fallback to local search if API fails
                const q = searchTerm.toLowerCase();
                return kalamData.filter(k =>
                    k.title.toLowerCase().includes(q) ||
                    k.book.toLowerCase().includes(q) ||
                    k.topic.toLowerCase().includes(q) ||
                    k.category.toLowerCase().includes(q) ||
                    k.shayar.toLowerCase().includes(q)
                );
            }
        }

        // Get kalams by specific topic
        async function getKalamsByTopic(topic) {
            try {
                // First try to get from local data
                const localResults = kalamData.filter(k => 
                    k.topic.toLowerCase() === topic.toLowerCase()
                );
                
                if (localResults.length > 0) {
                    return localResults;
                }
                
                // If not found locally, try API search
                const results = await searchKalamsFromAPI(topic);
                return results.filter(k => 
                    k.topic.toLowerCase().includes(topic.toLowerCase())
                );
            } catch (error) {
                console.error('Error getting kalams by topic:', error);
                return kalamData.filter(k => 
                    k.topic.toLowerCase().includes(topic.toLowerCase())
                );
            }
        }

        const getCountForKeyword = (keyword) => {
            const q = keyword.toLowerCase();
            return kalamData.filter(k =>
                k.title.toLowerCase().includes(q) ||
                k.shayar.toLowerCase().includes(q) ||
                k.topic.toLowerCase().includes(q) ||
                k.book.toLowerCase().includes(q) ||
                k.category.toLowerCase().includes(q)
            ).length;
        };

        // ----------- UI Rendering Utilities -----------

        const renderKalamList = (data, container, isSearchResults = false) => {
            // Store search results for later use
            if (isSearchResults) {
                currentSearchResults = data;
            }
            
            container.innerHTML = !data.length
                ? `<p class="text-center text-gray-500 mt-4">No Kalam found.</p>`
                : data.map((k, i) => {
                    const viewCount = formatCount(Math.floor(Math.random() * 14001) + 10000);
                    return `
                <a href="#" class="NaatLyrics-qalam-item flex items-center" data-id="${k.id}" data-slug="${generateSlug(k.title)}" style="animation-delay: ${i * 30}ms;">
                    <div class="NaatLyrics-qalam-emoji">${categoryEmojis[k.category] || '📜'}</div>
                    <div class="flex-grow">
                        <div class="NaatLyrics-labels-container">
                            <span class="NaatLyrics-category-label qalam-cat-${k.category?.toLowerCase() || 'default'}">${k.category}</span>
                            <span class="text-gray-300">/</span>
                            <span class="NaatLyrics-topic-label" style="background-image: ${topicGradients[k.topic] || topicGradients['Default']}">${k.topic}</span>
                        </div>
                        <h2 class="NaatLyrics-qalam-title">${k.title}</h2>
                        <p class="text-sm text-gray-600 font-semibold">${k.shayar}</p>
                    </div>
                    <div class="NaatLyrics-qalam-view-count">👁️ ${viewCount}</div>
                </a>`;
                }).join('');

            // Add event listeners to all kalam items
            container.querySelectorAll('.NaatLyrics-qalam-item').forEach(item => {
                item.addEventListener('click', function (e) {
                    e.preventDefault();
                    const id = parseInt(this.dataset.id);
                    const slug = this.dataset.slug;
                    showKalamDetailPage(id, slug);
                });
            });
        };

        const setupSlider = () => {
            const track = document.getElementById('NaatLyrics-slider-track');
            // Take first 6 naats as "top" for now -- or build logic as needed
            const featured = kalamData.filter(k => k.topKalam || true).slice(0, 6); // .topKalam if field, otherwise use your own filter
            featuredStoryList = featured.map(k => ({ ...k }));
            const gradients = [
                'linear-gradient(45deg, #065f46, #10b981)',
                'linear-gradient(45deg, #4f46e5, #818cf8)',
                'linear-gradient(45deg, #be123c, #fb7185)',
                'linear-gradient(45deg, #b45309, #f97316)',
                'linear-gradient(45deg, #4c1d95, #8b5cf6)',
                'linear-gradient(45deg, #9f1239, #ec4899)'
            ];

            track.innerHTML = featuredStoryList.map((k, i) => `
        <div class="NaatLyrics-slider-card" data-index="${i}" data-slug="${generateSlug(k.title)}">
            <div class="NaatLyrics-slider-card-inner" style="background-image: ${gradients[i % gradients.length]}">
                <div class="NaatLyrics-slider-card-labels"><span>${k.category}</span> / <span>${k.topic}</span></div>
                <div>
                    <h3 class="NaatLyrics-slider-card-title">${k.title}</h3>
                    <p class="NaatLyrics-slider-card-shayar">${k.shayar}</p>
                </div>
            </div>
        </div>
    `).join('');
        };

        // Story Viewer Section
        const showStory = (k, isSeq = false) => {
            const content = document.getElementById('NaatLyrics-story-content');
            let likes = Math.floor(Math.random() * 5000) + 1000;
            let storyLinesArr = (k.lyrics || '').split('\n').filter(Boolean);
            let firstTwoLines = storyLinesArr.slice(0, 2).join('<br>');

            // Progress bars (support for multiple stories)
            content.innerHTML = `
        <div class="NaatLyrics-story-progress-container">${featuredStoryList.map((_, i) =>
                `<div class="NaatLyrics-story-progress-bar ${i === currentStoryIndex ? 'active' : ''}"><div class="NaatLyrics-story-progress-bar-inner"></div></div>`).join('')}
        </div>
        <div id="NaatLyrics-story-close" class="NaatLyrics-story-close">&times;</div>
        <div class="NaatLyrics-story-topic-chip">${k.topic}</div>
        <div class="NaatLyrics-story-lyrics">${firstTwoLines}</div>
        <div class="NaatLyrics-story-meta">
          
            <p><strong>Book:</strong> ${k.book}</p>
        </div>
        <div class="NaatLyrics-story-actions">
            <button id="NaatLyrics-story-like-btn">❤️ <span id="like-count">${likes}</span></button>
            <span class="opacity-80">|</span>
            <span>👁️ ${formatCount(Math.floor(Math.random() * 10000) + 2000)}</span>
        </div>
        <div class="NaatLyrics-story-bottom-bar">
            <button class="NaatLyrics-story-share-btn">Share All</button>
            <button class="NaatLyrics-story-share-btn">Share on WhatsApp</button>
        </div>
    `;
            storyViewer.classList.add('active');
            content.querySelector('#NaatLyrics-story-close').addEventListener('click', closeStory);
            content.querySelector('#NaatLyrics-story-like-btn').addEventListener('click', e => {
                e.currentTarget.querySelector('#like-count').innerText = parseInt(e.currentTarget.querySelector('#like-count').innerText) + 1;
            });

            clearTimeout(storyTimeout);
            if (isSeq) {
                setTimeout(() => {
                    const bar = content.querySelector('.active .NaatLyrics-story-progress-bar-inner');
                    if (bar) bar.style.transition = 'width 5s linear';
                }, 50);
                storyTimeout = setTimeout(() => {
                    currentStoryIndex++;
                    if (currentStoryIndex >= featuredStoryList.length) closeStory();
                    else showStory(featuredStoryList[currentStoryIndex], true);
                }, 5000);
            }
        };

        const closeStory = () => {
            clearTimeout(storyTimeout);
            storyViewer.classList.remove('active');
        };

        // Sorting, category, topic, writers renderers
        const setupSorters = () => {
            const alphaSorter = document.getElementById('NaatLyrics-alphabet-sorter'),
                trendSorter = document.getElementById('NaatLyrics-trending-topics'),
                tabs = document.querySelector('.NaatLyrics-sorter-tabs'),
                panes = document.querySelectorAll('.NaatLyrics-tab-pane');

            alphaSorter.innerHTML = ['Top', 'All', ...'ABCDEFGHIJKLMNOPQRSTUVWXYZ']
                .map(l => `<button class="NaatLyrics-alpha-button ${l === 'All' ? 'active' : ''}" data-letter="${l}">${l}</button>`).join('');

            const topics = ["All", ...popularKeywords];
            trendSorter.innerHTML = topics.map(t =>
                `<button class="NaatLyrics-trending-topic" data-topic="${t}" style="background-image: ${(topicGradients[t] || topicGradients['Default'])}">
            ${t} <span class="count">${t === 'All' ? kalamData.length : getCountForKeyword(t)}</span>
        </button>`
            ).join('');

            tabs.addEventListener('click', e => {
                const btn = e.target.closest('.NaatLyrics-tab-button');
                if (!btn) return;
                document.querySelector('.NaatLyrics-tab-button.active').classList.remove('active');
                btn.classList.add('active');
                panes.forEach(p => p.classList.remove('active'));
                document.getElementById(`NaatLyrics-${btn.dataset.tab}-pane`).classList.add('active');
            });

            const filterList = (el, type, value) => {
                document.querySelector('.NaatLyrics-alpha-button.active')?.classList.remove('active');
                document.querySelector('.NaatLyrics-trending-topic.active')?.classList.remove('active');
                el.classList.add('active');
                let data;
                if (type === 'letter') {
                    if (value === 'All') data = kalamData;
                    else if (value === 'Top') data = kalamData.filter(k => k.topKalam || true); // adjust logic for .topKalam
                    else {
                        const upperVal = value.toUpperCase();
                        data = kalamData.filter(k => k.title.toUpperCase().startsWith(upperVal));
                    }
                } else {
                    if (value === 'All') data = kalamData;
                    else {
                        const q = value.toLowerCase();
                        data = kalamData.filter(k =>
                            k.title.toLowerCase().includes(q) ||
                            k.shayar.toLowerCase().includes(q) ||
                            k.topic.toLowerCase().includes(q) ||
                            k.book.toLowerCase().includes(q) ||
                            k.category.toLowerCase().includes(q)
                        );
                    }
                }
                renderKalamList(data, document.getElementById('NaatLyrics-qalam-list'));
            };

            alphaSorter.addEventListener('click', e => {
                const btn = e.target.closest('.NaatLyrics-alpha-button');
                if (btn) filterList(btn, 'letter', btn.dataset.letter);
            });
            trendSorter.addEventListener('click', e => {
                const btn = e.target.closest('.NaatLyrics-trending-topic');
                if (btn) filterList(btn, 'topic', btn.dataset.topic);
            });
        };

        const renderCategoryList = () => {
            const container = document.getElementById('NaatLyrics-category-list');
            const categories = [...new Set(kalamData.map(k => k.category))];
            container.innerHTML = categories.map(cat =>
                `<div class="NaatLyrics-list-item font-bold text-lg">${cat}</div>`).join('');
        };

        const renderTopicList = () => {
            const container = document.getElementById('NaatLyrics-topic-list');

            // Count kalams per topic
            const topicCounts = kalamData.reduce((acc, k) => {
                acc[k.topic] = (acc[k.topic] || 0) + 1;
                return acc;
            }, {});

            // Get unique topics sorted by count (descending)
            const topics = Object.keys(topicCounts).sort((a, b) => topicCounts[b] - topicCounts[a]);

            container.innerHTML = topics.map(topic => `
    <div class="NaatLyrics-list-item flex justify-between items-center" data-topic="${topic}">
        <span class="font-bold text-lg">${topic}</span>
        <span class="text-sm bg-blue-100 text-blue-800 px-2 py-1 rounded-full">
            ${topicCounts[topic]} Kalams
        </span>
    </div>
`).join('');

            // Add click event listeners to each topic item
            container.querySelectorAll('.NaatLyrics-list-item').forEach(item => {
                item.addEventListener('click', async function () {
                    const topic = this.dataset.topic;
                    
                    // Show loading state
                    const majmuaContainer = document.getElementById('NaatLyrics-qalam-list');
                    majmuaContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Loading kalams...</p>';
                    
                    // Switch to majmua page
                    switchPage('majmua');
                    
                    try {
                        // Get kalams for this specific topic
                        const topicKalams = await getKalamsByTopic(topic);
                        renderKalamList(topicKalams, majmuaContainer);
                        
                        if (topicKalams.length === 0) {
                            majmuaContainer.innerHTML = `<p class="text-center text-gray-500 mt-4">No kalams found for topic "${topic}"</p>`;
                        }
                    } catch (error) {
                        console.error('Error loading topic kalams:', error);
                        majmuaContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Error loading kalams. Please try again.</p>';
                    }
                });
            });
        };
        
        const renderWriterList = () => {
            const container = document.getElementById('NaatLyrics-writer-list');
            // Group by writer
            const writers = kalamData.reduce((acc, k) => {
                if (!acc[k.shayar]) acc[k.shayar] = { books: new Set(), count: 0 };
                acc[k.shayar].books.add(k.book);
                acc[k.shayar].count++;
                return acc;
            }, {});
            container.innerHTML = Object.entries(writers).map(([writer, data]) =>
                `<div class="NaatLyrics-list-item flex justify-between items-center">
            <div>
                <h3 class="font-bold text-lg">✍️ ${writer}</h3>
                <p class="text-sm text-gray-600 font-semibold mt-1">📚 ${[...data.books].join(', ')}</p>
            </div>
            <span class="text-xs font-bold text-gray-500 bg-gray-100 px-2 py-1 rounded-full">${data.count} Kalams</span>
        </div>`
            ).join('');
        };

        // Kalam Detail View
        const showKalamDetailPage = (id, slug = null) => {
            // First try to find in current search results
            let k = currentSearchResults.find(item => item.id === id);
            
            // If not found in search results, try main kalamData
            if (!k) {
                k = kalamData.find(item => item.id === id);
            }
            
            if (!k) {
                console.error('Kalam not found with ID:', id);
                return;
            }
            
            // Generate slug if not provided
            if (!slug) {
                slug = generateSlug(k.title);
            }
            
            // Update URL with slug
            updateURLWithSlug(slug);
            
            const saved = isKalamSaved(k.id);
            const title = `"${k.title}" Lyrics - by ${k.shayar} | Naat Academy`;
            const description = `Read the complete lyrics for "${k.title}" from the book ${k.book}, written by ${k.shayar}. Available on Naat Academy.`;
            document.title = title;

            // Set meta description for SEO
            const descTag = document.querySelector('meta[name="description"]');
            if (descTag) descTag.setAttribute('content', description);

            document.getElementById('NaatLyrics-qalam-detail-content').innerHTML = `
        <h2 class="text-3xl font-extrabold mb-4 text-center NaatLyrics-detail-title">${k.title}</h2>
        <div class="flex justify-center items-center gap-4 mb-4 text-sm text-gray-500 font-semibold">
            <span>${categoryEmojis[k.category] || '📜'} ${k.category}</span>
            <span><i class="bi bi-person-fill"></i> ${k.shayar}</span>
            <span><i class="bi bi-book-fill"></i> ${k.book}</span>
        </div>
        <div class="NaatLyrics-detail-actions">
            <button class="NaatLyrics-action-btn font-urdu">اردو کلام</button>
            <button id="NaatLyrics-save-kalam-btn" data-id="${k.id}" class="${saved ? 'saved' : ''}"><i class="bi ${saved ? 'bi-heart-fill' : 'bi-heart'}"></i> ${saved ? 'Saved' : 'Save'}</button>
            <button id="NaatLyrics-share-kalam-btn" data-id="${k.id}"><i class="bi bi-share-fill"></i> Share</button>
        </div>
        <div class="NaatLyrics-qalam-pane">${k.lyrics.replace(/\n/g, '<br>')}</div>
    `;
            document.getElementById('NaatLyrics-save-kalam-btn').addEventListener('click', e => {
                const btn = e.currentTarget, id = parseInt(btn.dataset.id);
                if (isKalamSaved(id)) {
                    unsaveKalam(id);
                    btn.innerHTML = '<i class="bi bi-heart"></i> Save';
                    btn.classList.remove('saved');
                } else {
                    saveKalam(id);
                    btn.innerHTML = '<i class="bi bi-heart-fill"></i> Saved';
                    btn.classList.add('saved');
                }
            });
            document.getElementById('NaatLyrics-share-kalam-btn').addEventListener('click', e => {
                const id = parseInt(e.currentTarget.dataset.id);
                const kalam = kalamData.find(item => item.id === id) || currentSearchResults.find(item => item.id === id);
                if (kalam) {
                    if (navigator.share) {
                        navigator.share({
                            title: `${kalam.title} - Naat Academy`,
                            text: `Read the beautiful kalam "${kalam.title}" by ${kalam.shayar} on Naat Academy.\n\n${kalam.lyrics.substring(0, 100)}...`,
                            url: window.location.href,
                        });
                    } else {
                        const shareText = `${kalam.title} - by ${kalam.shayar}\n\n${kalam.lyrics}`;
                        navigator.clipboard.writeText(shareText).then(() => {
                            alert('Kalam copied to clipboard!');
                        });
                    }
                }
            });
            switchPage('qalam-detail', true);
        };

        // Switch pages helper
        const switchPage = (id, isDetail = false) => {
            pages.forEach(p => p.classList.remove('active'));
            document.getElementById(`NaatLyrics-page-${id}`)?.classList.add('active');
            let title = "Naat Academy";
            switch (id) {
                case 'category': title = "Categories"; renderCategoryList(); break;
                case 'topics': title = "Topics"; renderTopicList(); break;
                case 'writers': title = "Writers"; renderWriterList(); break;
                case 'saved': title = "Saved Kalams"; renderKalamList(kalamData.filter(k => isKalamSaved(k.id)), document.getElementById('NaatLyrics-saved-list')); break;
            }
            backButton.classList.toggle('hidden', !isDetail);
            brandHeader.classList.toggle('hidden', isDetail);
            if (!isDetail) {
                pageHistory = [id];
                document.querySelector('.NaatLyrics-bottom-nav-item.active')?.classList.remove('active');
                document.querySelector(`.NaatLyrics-bottom-nav-item[data-page="${id}"]`)?.classList.add('active');
                
                // Remove slug from URL when navigating away from detail view
                if (window.location.search.includes('kalam=')) {
                    removeSlugFromURL();
                }
            } else if (pageHistory[pageHistory.length - 1] !== id) {
                pageHistory.push(id);
            }
        };

        // Render search chips for popular keywords and topics
        const renderSearchChips = () => {
            // Combine popular keywords with unique topics
            const allSearchTerms = [...new Set([...popularKeywords, ...allTopics])];
            
            searchChipsContainer.innerHTML = allSearchTerms.map(term =>
                `<button class="NaatLyrics-search-chip" data-keyword="${term}">${term}</button>`).join('');
        };

        // Function to search by topic
        const searchByTopic = async (topic) => {
            // Show loading state
            searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Searching...</p>';
            
            try {
                // Search for the topic
                const results = await getKalamsByTopic(topic);
                renderKalamList(results, searchResultsContainer, true);
                
                if (results.length === 0) {
                    searchResultsContainer.innerHTML = `<p class="text-center text-gray-500 mt-4">No results found for topic "${topic}"</p>`;
                }
            } catch (error) {
                console.error('Topic search error:', error);
                searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Search failed. Please try again.</p>';
            }
        };

        //--------------------------------------------------------
        // Event Listeners & User Interactions
        //--------------------------------------------------------
        backButton.addEventListener('click', () => {
            pageHistory.pop();
            const prevPage = pageHistory[pageHistory.length - 1] || 'majmua';
            switchPage(prevPage);
            
            // Remove slug from URL when going back
            if (window.location.search.includes('kalam=')) {
                removeSlugFromURL();
            }
        });

        bottomNav.addEventListener('click', e => {
            const item = e.target.closest('.NaatLyrics-bottom-nav-item');
            if (item) switchPage(item.dataset.page);
        });

        mainContainer.addEventListener('click', e => {
            const item = e.target.closest('.NaatLyrics-qalam-item');
            if (item) {
                e.preventDefault();
                const id = parseInt(item.dataset.id);
                const slug = item.dataset.slug;
                showKalamDetailPage(id, slug);
            }
        });

        // Slider click for story
        document.getElementById('NaatLyrics-slider-track').addEventListener('click', e => {
            const card = e.target.closest('.NaatLyrics-slider-card');
            if (card) {
                currentStoryIndex = parseInt(card.dataset.index);
                const slug = card.dataset.slug;
                showStory(fedaturedStoryList[currentStoryIndex], true);
                
                // Update URL with slug for the story
                updateURLWithSlug(slug);
            }
        });

        searchIconBtn.addEventListener('click', () => searchPopup.classList.add('active'));
        searchCloseBtn.addEventListener('click', () => searchPopup.classList.remove('active'));
        
        // Enhanced search functionality
        let searchTimeout;
        searchInput.addEventListener('input', async (e) => {
            const q = e.target.value.trim().toLowerCase();
            
            // Clear previous timeout
            clearTimeout(searchTimeout);
            
            // Show loading state
            searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Searching...</p>';
            
            // Set a timeout to prevent too many API calls
            searchTimeout = setTimeout(async () => {
                if (q.length < 2) {
                    searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Type at least 2 characters to search</p>';
                    return;
                }
                
                try {
                    // Use API search for better results
                    const results = await searchKalamsFromAPI(q);
                    renderKalamList(results, searchResultsContainer, true);
                    
                    if (results.length === 0) {
                        searchResultsContainer.innerHTML = `<p class="text-center text-gray-500 mt-4">No results found for "${q}"</p>`;
                    }
                } catch (error) {
                    console.error('Search error:', error);
                   searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Search failed. Please try again.</p>';
                }
            }, 500); // 500ms debounce
        });

        // Search chip click handler - now supports both keywords and topics
        searchChipsContainer.addEventListener('click', async (e) => {
            const chip = e.target.closest('.NaatLyrics-search-chip');
            if (chip) {
                const keyword = chip.dataset.keyword || chip.textContent;
                searchInput.value = keyword;
                
                // Check if this is a topic (exists in our topics list)
                if (allTopics.includes(keyword)) {
                    // This is a topic, search specifically by topic
                    await searchByTopic(keyword);
                } else {
                    // This is a regular keyword, perform normal search
                    searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Searching...</p>';
                    
                    try {
                        // Search for the keyword
                        const results = await searchKalamsFromAPI(keyword);
                        renderKalamList(results, searchResultsContainer, true);
                        
                        if (results.length === 0) {
                            searchResultsContainer.innerHTML = `<p class="text-center text-gray-500 mt-4">No results found for "${keyword}"</p>`;
                        }
                    } catch (error) {
                        console.error('Search error:', error);
                        searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 mt-4">Search failed. Please try again.</p>';
                    }
                }
                
                searchInput.focus();
            }
        });

        // Add event listener for search result items
        searchResultsContainer.addEventListener('click', e => {
            const item = e.target.closest('.NaatLyrics-qalam-item');
            if (item) {
                e.preventDefault();
                const id = parseInt(item.dataset.id);
                const slug = item.dataset.slug;
                showKalamDetailPage(id, slug);
                searchPopup.classList.remove('active');
            }
        });

        // Handle browser back/forward navigation
        window.addEventListener('popstate', () => {
            const kalamId = getKalamIdFromSlug();
            if (kalamId) {
                showKalamDetailPage(kalamId);
            } else if (document.getElementById('NaatLyrics-page-qalam-detail').classList.contains('active')) {
                // If we're on the detail page but no slug in URL, go back to main page
                switchPage('majmua');
            }
        });

        //--------------------------------------------------------
        // Initial App Load
        //--------------------------------------------------------
        async function init() {
            kalamData = await fetchKalamData();
            // If your API response does not have .topKalam, use logic to define top stories
            // e.g. mark first 6 as topKalam for story slider
            kalamData.sort((a, b) => a.title.localeCompare(b.title));
            
            // Extract all unique topics from kalamData
            allTopics = [...new Set(kalamData.map(k => k.topic))].filter(topic => topic);
            
            setupSlider();
            setupSorters();
            renderKalamList(kalamData, document.getElementById('NaatLyrics-qalam-list'));
            renderSearchChips();
            document.querySelector('.NaatLyrics-tab-button[data-tab="trending"]')?.click();
            // Set "All" trending topic to be active on load
            const allTrendingTopic = document.querySelector('.NaatLyrics-trending-topic[data-topic="All"]');
            if (allTrendingTopic) allTrendingTopic.click();
            
            // Check if URL has a kalam slug on initial load
            const kalamId = getKalamIdFromSlug();
            if (kalamId) {
                showKalamDetailPage(kalamId);
            }
        }

        init();
    });
</script>
</body>

</html>