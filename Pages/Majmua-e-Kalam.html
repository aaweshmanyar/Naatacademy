<!DOCTYPE html>
<html lang="ur" dir="rtl">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>کلام کی فہرست - نعت اکیڈمی</title>
    <meta name="description"
        content="نعت اکیڈمی میں اسلامی شاعری، حمد، نعت، منقبت، اور سلام کی مکمل فہرست دریافت کریں۔" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <style>
        /* Custom Font for Urdu Text */
        @font-face {
            font-family: "NaatFont";
            src: url("https://res.cloudinary.com/awescreative/raw/upload/v1749150996/Awes/naatfont.ttf") format("truetype");
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* Base Body Styles */
        html {
            height: 100%;
        }

        body {
            font-family: "Inter", sans-serif;
            background: #f8f9fc;
            /* A slightly different background */
            color: #333;
            display: flex;
            flex-direction: column;
            min-height: 100%;
        }

        main {
            flex-grow: 1;
        }

        /* Urdu Text Specific Styles */
        .urdu-text {
            font-family: "NaatFont", "Noto Nastaliq Urdu", serif;
            line-height: 1.9;
            font-size: 1.25rem;
        }

        .urdu-text-sm {
            font-size: 1.05rem;
        }

        .urdu-text-xs {
            font-size: 0.9rem;
        }

        /* Header Gradient Background */
        .header-gradient {
            background: #ffffff;
        }

        /* List Item Card Styles */
        .kalam-item-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 15px -2px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e9eef2;
            border-right-width: 4px;
            overflow: hidden;
            padding: 0.75rem 1rem;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        .kalam-item-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px -5px rgba(0, 0, 0, 0.08);
        }

        /* Filter Tab Styles */
        .filter-tab {
            padding: 0.25rem 1rem;
            /* Reduced padding */
            border-radius: 9999px;
            background-color: transparent;
            color: #4b5563;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .filter-tab:hover {
            background-color: #f3f4f6;
        }

        .filter-tab.active {
            color: #14b8a6;
            border-color: #14b8a6;
            background-color: #f0fdfa;
        }

        /* Alphabet Filter Styles */
        .alphabet-filter-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 0.25rem;
            /* Reduced gap */
            transition: all 0.3s ease-in-out;
        }

        .alphabet-button {
            background-color: #f3f4f6;
            color: #374151;
            border: 1px solid #e5e7eb;
            border-radius: 9999px;
            width: 34px;
            /* Reduced size */
            height: 34px;
            /* Reduced size */
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: "NaatFont", "Noto Nastaliq Urdu", serif;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }

        .alphabet-button:hover {
            background-color: #e5e7eb;
            transform: scale(1.05);
        }

        .alphabet-button.active {
            background-color: #0d9488;
            color: white;
            border-color: #0d9488;
            font-weight: bold;
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(13, 148, 136, 0.4);
        }

        .footer-bg {
            background-color: #2a415a;
            color: #cbd5e1;
            flex-shrink: 0;
        }

        /* Mobile App-like Bottom Bar */
        .bottom-nav {
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }

        .bottom-nav-button {
            transition: all 0.2s ease;
        }

        .bottom-nav-button.active {
            color: #14b8a6;
            transform: scale(1.1);
        }

        #loadMoreBtn {
            background-color: #14b8a6;
            color: white;
            transition: all 0.3s ease;
            font-family: "NaatFont", "Noto Nastaliq Urdu", serif;
        }

        #loadMoreBtn:hover {
            background-color: #0d9488;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(20, 184, 166, 0.3);
        }

        .whatsapp-fab {
            position: fixed;
            width: 55px;
            height: 55px;
            bottom: 25px;
            right: 25px;
            background-color: #25d366;
            color: #fff;
            border-radius: 50px;
            text-align: center;
            font-size: 28px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .whatsapp-fab:hover {
            transform: scale(1.1);
        }

        @media (max-width: 767px) {
            .whatsapp-fab {
                bottom: 80px;
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
        }
    </style>
</head>

<body class="bg-gray-100">
    <!-- Header Section -->
    <header class="header-gradient py-1 shadow-sm">
        <div class="container mx-auto px-4">
            <div class="flex justify-center items-center gap-6 py-1 border-b border-gray-200">
                <a href="#"
                    class="text-gray-700 hover:text-teal-600 text-sm urdu-text urdu-text-sm font-medium transition-colors">سرورق</a>
                <a href="#"
                    class="text-gray-700 hover:text-teal-600 text-sm urdu-text urdu-text-sm font-medium transition-colors">کتابیں</a>
                <a href="#"
                    class="text-gray-700 hover:text-teal-600 text-sm urdu-text urdu-text-sm font-medium transition-colors">درود
                    شریف</a>
            </div>
            <div class="text-center my-2">
                <a href="../index.html" aria-label="Naat Academy Home">
                    <img src="https://res.cloudinary.com/awescreative/image/upload/v1749154768/Awes/new_logo_naat_academy_image.png"
                        alt="نعت اکیڈمی لوگو" class="h-16 md:h-20 mx-auto" />
                </a>
            </div>
        </div>
    </header>

    <!-- Search and Filter Section (Sticky Top Bar) -->
    <div class="bg-white/90 backdrop-blur-sm sticky top-0 z-20 shadow-sm">
        <div class="container mx-auto px-4 py-2">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 items-center">
                <div class="flex items-center gap-2">
                    <div class="relative flex-grow">
                        <input type="text" id="searchInput" placeholder="کلام، شاعر یا کتاب تلاش کریں..."
                            class="w-full bg-gray-100 border-2 border-transparent rounded-full text-right px-5 py-2 focus:ring-2 focus:ring-teal-400 focus:border-teal-400 urdu-text urdu-text-sm transition-all" />
                        <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">
                            <i class="bi bi-search"></i>
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <div class="relative flex-grow">
                        <select id="categoryFilterDropdown"
                            class="w-full bg-gray-100 border-2 border-transparent rounded-full text-right px-4 py-2 focus:ring-2 focus:ring-teal-400 focus:border-teal-400 urdu-text urdu-text-sm transition-all appearance-none pr-8 cursor-pointer">
                            <!-- Options inserted dynamically -->
                        </select>
                        <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
                            <i class="bi bi-chevron-down text-xs"></i>
                        </div>
                    </div>
                    <div class="relative flex-grow">
                        <select id="poetFilterDropdown"
                            class="w-full bg-gray-100 border-2 border-transparent rounded-full text-right px-4 py-2 focus:ring-2 focus:ring-teal-400 focus:border-teal-400 urdu-text urdu-text-sm transition-all appearance-none pr-8 cursor-pointer">
                            <!-- Options inserted dynamically -->
                        </select>
                        <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none">
                            <i class="bi bi-chevron-down text-xs"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <main class="container mx-auto px-4 pb-24 max-w-7xl">
        <!-- Combined Sort and Alphabet Filter -->
        <div id="sortAndFilterPanel" class="bg-white rounded-xl shadow-md my-6 p-2 hidden md:block">
            <div class="flex justify-center flex-wrap gap-2 mb-2" id="filterTabs">
                <button class="filter-tab urdu-text urdu-text-sm active" data-filter="tahajji">حروفِ تہجی</button>
                <button class="filter-tab urdu-text urdu-text-sm" data-filter="radif">حروفِ ردیف</button>
                <button class="filter-tab urdu-text urdu-text-sm" data-filter="popular">مقبول ترین</button>
            </div>
            <div id="alphabetContent" class="pt-2 border-t border-gray-100">
                <div id="alphabetNavContainer" class="alphabet-filter-container">
                    <!-- Alphabet buttons injected dynamically -->
                </div>
            </div>
        </div>

        <!-- Kalam List Container -->
        <div id="kalamListContainer" class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Kalam items injected here -->
        </div>

        <div id="noResults" class="text-center py-10 hidden">
            <i class="bi bi-search-heart text-5xl text-gray-400 mb-4"></i>
            <p class="urdu-text text-xl text-gray-600">کوئی نتیجہ نہیں ملا۔</p>
            <p class="urdu-text text-gray-500">براہ کرم کوئی دوسرا لفظ تلاش کریں یا فلٹر تبدیل کریں۔</p>
        </div>

        <!-- Load More Button -->
        <div id="loadMoreContainer" class="text-center mt-8">
            <button id="loadMoreBtn" class="py-2 px-6 rounded-full text-sm urdu-text shadow-lg">
                مزید لوڈ کریں
            </button>
        </div>
    </main>

    <!-- Bottom Navigation (Mobile Only) -->
    <div
        class="md:hidden fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-20 p-2 flex justify-around items-center bottom-nav">
        <button id="mobileToggleFilter" class="bottom-nav-button text-gray-600 flex flex-col items-center">
            <i class="bi bi-funnel-fill text-xl"></i>
            <span class="text-xs font-medium">ترتیب و فلٹر</span>
        </button>
    </div>

    <!-- WhatsApp Floating Icon -->
    <a href="https://whatsapp.com/channel/0029Va98TkcKrWQpctdEpu0f" target="_blank" class="whatsapp-fab"
        aria-label="Join WhatsApp Channel">
        <i class="bi bi-whatsapp"></i>
    </a>

    <!-- Footer Section -->
    <footer class="footer-bg py-6 text-center shadow-inner">
        <div class="container mx-auto px-4">
            <p class="text-sm text-gray-300">
                کاپی رائٹ © <span id="currentYear"></span> نعت اکیڈمی آرگنائزیشن۔ جملہ حقوق محفوظ ہیں۔
            </p>
            <p class="text-xs mt-2 opacity-80 text-gray-400">
                Founder and managed by
                <a href="https://www.facebook.com/OwaisRazvi/" target="_blank" class="hover:underline">Owais Razvi</a>
            </p>
        </div>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const apiUrl = "https://updated-naatacademy.onrender.com/api/kalaam";

            let allKalam = [];
            let currentSort = "alpha_asc";
            let currentAlphaFilter = "all";
            let currentPoetFilter = "all";
            let currentCategoryFilter = "all";
            let currentFilteredKalam = [];
            let currentPage = 1;
            const itemsPerPage = 8;

            // --- DOM Elements ---
            const container = document.getElementById("kalamListContainer");
            const searchInput = document.getElementById("searchInput");
            const noResultsDiv = document.getElementById("noResults");
            const alphabetNavContainer = document.getElementById("alphabetNavContainer");
            const alphabetContent = document.getElementById("alphabetContent");
            const sortAndFilterPanel = document.getElementById("sortAndFilterPanel");
            const filterTabs = document.getElementById("filterTabs");
            const poetFilterDropdown = document.getElementById("poetFilterDropdown");
            const categoryFilterDropdown = document.getElementById("categoryFilterDropdown");
            const mobileToggleFilter = document.getElementById("mobileToggleFilter");
            const loadMoreBtn = document.getElementById("loadMoreBtn");
            const loadMoreContainer = document.getElementById("loadMoreContainer");

            // Fetch kalam data from API
            async function fetchKalaam() {
                try {
                    const response = await fetch(apiUrl);
                    if (!response.ok) throw new Error("Network response was not ok");
                    const data = await response.json();

                    // Map API data to kalam format with first 2 lines of ContentUrdu
                    allKalam = data.map((item) => {
                        const linesArray = item.ContentUrdu
                            ? item.ContentUrdu.split("\n").filter((l) => l.trim() !== "")
                            : [];
                        // Join first 2 lines with <br>
                        const firstTwoLines = linesArray.slice(0, 2).join("<br>");

                        return {
                            id: item.KalaamID,
                            lines: firstTwoLines,
                            poet: item.WriterName || "نامعلوم",
                            book: item.Bookname || item.GroupName || "مختلف",
                            category: item.CategoryName || "مختلف",
                            views: item.Views || 0,
                        };
                    });

                    createPoetFilter();
                    createCategoryFilter();
                    createAlphabetFilter("asc");
                    applyFiltersAndRender();
                } catch (error) {
                    console.error("Failed to fetch Kalaam:", error);
                    container.innerHTML = `<p class="urdu-text text-center text-red-600 py-10">کلام کی فہرست حاصل کرنے میں مسئلہ پیش آیا۔ دوبارہ کوشش کریں۔</p>`;
                }
            }

            // Create Alphabet Filter Buttons
            function createAlphabetFilter(order = "asc") {
                const urduAlphabet = [
                    "ا",
                    "ب",
                    "پ",
                    "ت",
                    "ٹ",
                    "ث",
                    "ج",
                    "چ",
                    "ح",
                    "خ",
                    "د",
                    "ڈ",
                    "ذ",
                    "ر",
                    "ڑ",
                    "ز",
                    "ژ",
                    "س",
                    "ش",
                    "ص",
                    "ض",
                    "ط",
                    "ظ",
                    "ع",
                    "غ",
                    "ف",
                    "ق",
                    "ک",
                    "گ",
                    "ل",
                    "م",
                    "ن",
                    "و",
                    "ہ",
                    "ی",
                ];
                if (order === "desc") {
                    urduAlphabet.reverse();
                }
                let buttonsHTML = `<button class="alphabet-button active" data-letter="all">کل</button>`;
                urduAlphabet.forEach((letter) => {
                    buttonsHTML += `<button class="alphabet-button" data-letter="${letter}">${letter}</button>`;
                });
                alphabetNavContainer.innerHTML = buttonsHTML;
            }

            // Populate Poet Filter Dropdown
            function createPoetFilter() {
                const poets = [...new Set(allKalam.map((k) => k.poet))];
                poets.sort((a, b) => a.localeCompare(b, "ur"));
                let optionsHTML = `<option value="all">تمام شعراء</option>`;
                poets.forEach((poet) => {
                    optionsHTML += `<option value="${poet}">${poet}</option>`;
                });
                poetFilterDropdown.innerHTML = optionsHTML;
            }

            // Populate Category Filter Dropdown
            function createCategoryFilter() {
                const categories = [...new Set(allKalam.map((k) => k.category))];
                categories.sort((a, b) => a.localeCompare(b, "ur"));
                let optionsHTML = `<option value="all">تمام اصناف</option>`;
                categories.forEach((cat) => {
                    optionsHTML += `<option value="${cat}">${cat}</option>`;
                });
                categoryFilterDropdown.innerHTML = optionsHTML;
            }

            // Render kalam list cards
            function renderKalamList(kalamArray) {
                if (kalamArray.length === 0 && currentPage === 1) {
                    noResultsDiv.classList.remove("hidden");
                } else {
                    noResultsDiv.classList.add("hidden");
                }

                kalamArray.forEach((kalam) => {
                    const categoryColors = {
                        نعت: "bg-green-100 text-green-800",
                        سلام: "bg-blue-100 text-blue-800",
                        منقبت: "bg-amber-100 text-amber-800",
                        default: "bg-gray-100 text-gray-800",
                    };
                    const borderColors = {
                        نعت: "border-r-green-500",
                        سلام: "border-r-blue-500",
                        منقبت: "border-r-amber-500",
                        default: "border-r-gray-300",
                    };
                    const colorClass = categoryColors[kalam.category] || categoryColors.default;
                    const borderColorClass = borderColors[kalam.category] || borderColors.default;


                    const card = `
  <div class="kalam-item-card ${borderColorClass}" style="cursor: pointer;" data-id="${kalam.id}">
    <p class="urdu-text text-gray-800 mb-2 flex-grow">${kalam.lines}</p>
    <div class="border-t border-gray-100 pt-2 mt-auto">
      <div class="flex items-center justify-between flex-wrap gap-x-2 gap-y-1 text-gray-600">
        <div class="flex items-center gap-2">
          <span class="urdu-text urdu-text-xs py-0.5 px-2 rounded-full ${colorClass}">${kalam.category}</span>
          <p class="urdu-text urdu-text-xs text-gray-600">
            <i class="bi bi-person-fill text-gray-400 ml-1"></i>
            <span class="font-semibold">${kalam.poet}</span>
            <span class="text-gray-400 mx-1">|</span>
            <i class="bi bi-book-fill text-gray-400 ml-1"></i>${kalam.book}
          </p>
        </div>
        <div class="flex items-center gap-1 text-gray-400">
          <i class="bi bi-eye-fill"></i>
          <span class="font-sans text-[10px] font-bold">${kalam.views.toLocaleString("en-US")}</span>
        </div>
      </div>
    </div>
  </div>
`;
                    ;
                    container.innerHTML += card;

                    container.querySelectorAll('.kalam-item-card').forEach(card => {
                        card.addEventListener('click', () => {
                            const id = card.dataset.id;
                            if (id) {
                                window.location.href = `lyrics.html?id=${encodeURIComponent(id)}`;
                            }
                        });
                    });

                });
            }

            // Show current page items and manage Load More button
            function displayCurrentPage() {
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const itemsToDisplay = currentFilteredKalam.slice(startIndex, endIndex);

                renderKalamList(itemsToDisplay);

                if (endIndex >= currentFilteredKalam.length) {
                    loadMoreContainer.classList.add("hidden");
                } else {
                    loadMoreContainer.classList.remove("hidden");
                }
            }

            // Filter, sort and render kalam
            function applyFiltersAndRender() {
                let filteredKalam = [...allKalam];
                if (currentCategoryFilter !== "all")
                    filteredKalam = filteredKalam.filter((k) => k.category === currentCategoryFilter);
                if (currentPoetFilter !== "all")
                    filteredKalam = filteredKalam.filter((k) => k.poet === currentPoetFilter);

                const searchQuery = searchInput.value.toLowerCase();
                if (searchQuery) {
                    filteredKalam = filteredKalam.filter(
                        (k) =>
                            k.lines.toLowerCase().includes(searchQuery) ||
                            k.poet.toLowerCase().includes(searchQuery) ||
                            k.book.toLowerCase().includes(searchQuery)
                    );
                }
                if (currentAlphaFilter !== "all") {
                    filteredKalam = filteredKalam.filter((k) =>
                        k.lines.replace(/<br>/g, " ").trim().startsWith(currentAlphaFilter)
                    );
                }

                if (currentSort === "alpha_asc") {
                    filteredKalam.sort((a, b) => a.lines.localeCompare(b.lines, "ur"));
                } else if (currentSort === "alpha_desc") {
                    filteredKalam.sort((a, b) => b.lines.localeCompare(a.lines, "ur"));
                } else {
                    filteredKalam.sort((a, b) => b.views - a.views);
                }

                currentFilteredKalam = filteredKalam;
                currentPage = 1;
                container.innerHTML = "";
                displayCurrentPage();
            }

            // Reset filters except the changed one
            function resetOtherFilters(changedFilter) {
                if (changedFilter !== "search") searchInput.value = "";
                if (changedFilter !== "poet") poetFilterDropdown.value = "all";
                if (changedFilter !== "category") categoryFilterDropdown.value = "all";
                if (changedFilter !== "alpha") {
                    currentAlphaFilter = "all";
                    document.querySelectorAll(".alphabet-button").forEach((btn) => btn.classList.remove("active"));
                    const allButton = alphabetNavContainer.querySelector('.alphabet-button[data-letter="all"]');
                    if (allButton) allButton.classList.add("active");
                }
            }

            // --- Event Listeners ---
            searchInput.addEventListener("input", () => {
                resetOtherFilters("search");
                currentPoetFilter = "all";
                currentCategoryFilter = "all";
                applyFiltersAndRender();
            });

            poetFilterDropdown.addEventListener("change", (e) => {
                currentPoetFilter = e.target.value;
                resetOtherFilters("poet");
                currentCategoryFilter = categoryFilterDropdown.value;
                applyFiltersAndRender();
            });

            categoryFilterDropdown.addEventListener("change", (e) => {
                currentCategoryFilter = e.target.value;
                resetOtherFilters("category");
                currentPoetFilter = poetFilterDropdown.value;
                applyFiltersAndRender();
            });

            filterTabs.addEventListener("click", (e) => {
                if (e.target.matches(".filter-tab")) {
                    const filterType = e.target.dataset.filter;
                    document.querySelectorAll(".filter-tab").forEach((tab) => tab.classList.remove("active"));
                    e.target.classList.add("active");

                    if (filterType === "tahajji") {
                        alphabetContent.classList.remove("hidden");
                        createAlphabetFilter("asc");
                        currentSort = "alpha_asc";
                    } else if (filterType === "radif") {
                        alphabetContent.classList.remove("hidden");
                        createAlphabetFilter("desc");
                        currentSort = "alpha_desc";
                    } else if (filterType === "popular") {
                        alphabetContent.classList.add("hidden");
                        currentSort = "views";
                    }
                    resetOtherFilters("sort");
                    applyFiltersAndRender();
                }
            });

            mobileToggleFilter.addEventListener("click", () => {
                sortAndFilterPanel.classList.toggle("hidden");
                mobileToggleFilter.classList.toggle("active");
            });

            alphabetNavContainer.addEventListener("click", (e) => {
                if (e.target.matches(".alphabet-button")) {
                    currentAlphaFilter = e.target.dataset.letter;
                    resetOtherFilters("alpha");
                    document.querySelectorAll(".alphabet-button").forEach((btn) => btn.classList.remove("active"));
                    e.target.classList.add("active");
                    applyFiltersAndRender();
                }
            });

            loadMoreBtn.addEventListener("click", () => {
                currentPage++;
                displayCurrentPage();
            });

            // --- Initialization ---
            const currentYearEl = document.getElementById("currentYear");
            if (currentYearEl) {
                currentYearEl.textContent = new Date().getFullYear();
            }

            fetchKalaam();
        });
    </script>
</body>

</html>